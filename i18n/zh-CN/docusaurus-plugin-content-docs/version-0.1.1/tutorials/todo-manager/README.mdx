---
sidebar_position: 2
sidebar_label: 'æ•™ç¨‹ï¼šæ„å»ºä¸€ä¸ªå¾…åŠäº‹é¡¹ç®¡ç†å™¨'
---

import TabItem from '@theme/TabItem';
import Tabs from '@theme/Tabs';

import SetupOauthOrOidc from './_setup-oauth-or-oidc.mdx';
import SetupOidc from './_setup-oidc.mdx';

# æ•™ç¨‹ï¼šæ„å»ºä¸€ä¸ªå¾…åŠäº‹é¡¹ç®¡ç†å™¨

åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬å°†æ„å»ºä¸€ä¸ªå¸¦æœ‰ç”¨æˆ·è®¤è¯ (Authentication) å’Œæˆæƒ (Authorization) çš„å¾…åŠäº‹é¡¹ç®¡ç†å™¨ MCP æœåŠ¡å™¨ã€‚

å®Œæˆæœ¬æ•™ç¨‹åï¼Œä½ å°†è·å¾—ï¼š

- âœ… å¯¹å¦‚ä½•åœ¨ MCP æœåŠ¡å™¨ä¸­è®¾ç½®åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶ (RBAC) æœ‰åŸºæœ¬äº†è§£ã€‚
- âœ… ä¸€ä¸ªå¯ä»¥ç®¡ç†ä¸ªäººå¾…åŠäº‹é¡¹åˆ—è¡¨çš„ MCP æœåŠ¡å™¨ã€‚

:::note
åœ¨å¼€å§‹ä¹‹å‰ï¼Œå¦‚æœä½ å¯¹ MCP æœåŠ¡å™¨å’Œ OAuth 2 ä¸ç†Ÿæ‚‰ï¼Œå¼ºçƒˆå»ºè®®ä½ å…ˆé˜…è¯» [Who am I æ•™ç¨‹](./whoami)ã€‚
:::

## æ¦‚è§ˆ \{#overview}

æœ¬æ•™ç¨‹å°†æ¶‰åŠä»¥ä¸‹ç»„ä»¶ï¼š

- **MCP æœåŠ¡å™¨**ï¼šä¸€ä¸ªä½¿ç”¨ MCP å®˜æ–¹ SDK å¤„ç†è¯·æ±‚çš„ç®€å• MCP æœåŠ¡å™¨ï¼Œé›†æˆäº†ç”¨äºç®¡ç†ç”¨æˆ·å¾…åŠäº‹é¡¹çš„ Todo æœåŠ¡ã€‚
- **MCP inspector**ï¼šä¸€ä¸ªç”¨äº MCP æœåŠ¡å™¨çš„å¯è§†åŒ–æµ‹è¯•å·¥å…·ã€‚å®ƒè¿˜å……å½“ OAuth / OIDC å®¢æˆ·ç«¯ï¼Œç”¨äºå‘èµ·æˆæƒæµç¨‹å¹¶è·å–è®¿é—®ä»¤ç‰Œ (Access token)ã€‚
- **æˆæƒ (Authorization) æœåŠ¡å™¨**ï¼šä¸€ä¸ª OAuth 2.1 æˆ– OpenID Connect æä¾›å•†ï¼Œè´Ÿè´£ç®¡ç†ç”¨æˆ·èº«ä»½å¹¶ç­¾å‘è®¿é—®ä»¤ç‰Œ (Access token)ã€‚

ä»¥ä¸‹æ˜¯è¿™äº›ç»„ä»¶ä¹‹é—´äº¤äº’çš„é«˜çº§æµç¨‹å›¾ï¼š

```mermaid
sequenceDiagram
    participant Client as MCP Inspector
    participant Server as MCP Server
    participant Auth as æˆæƒ (Authorization) æœåŠ¡å™¨

    Client->>Server: è¯·æ±‚å¾…åŠäº‹é¡¹æ“ä½œ
    Server->>Client: è¿”å› 401 æœªæˆæƒ
    Client->>Auth: å‘èµ·æˆæƒ (Authorization) æµç¨‹
    Auth->>Auth: å®Œæˆæˆæƒ (Authorization) æµç¨‹
    Auth->>Client: å¸¦æˆæƒç é‡å®šå‘å›å®¢æˆ·ç«¯
    Client->>Auth: ç”¨æˆæƒç æ¢å–è®¿é—®ä»¤ç‰Œ (Access token)
    Auth->>Client: è¿”å›è®¿é—®ä»¤ç‰Œ (Access token)
    Client->>Server: æºå¸¦è®¿é—®ä»¤ç‰Œ (Access token) è¯·æ±‚å¾…åŠäº‹é¡¹æ“ä½œ
    Server->>Server: éªŒè¯è®¿é—®ä»¤ç‰Œ (Access token) å¹¶ä»ä¸­è·å–ç”¨æˆ·æƒé™ (Scopes)
    Note over Server: æ‰§è¡Œå¾…åŠäº‹é¡¹æ“ä½œ
    Server->>Client: è¿”å›å¾…åŠäº‹é¡¹æ“ä½œç»“æœ
```

## äº†è§£ä½ çš„æˆæƒ (Authorization) æœåŠ¡å™¨ \{#understand-your-authorization-server}

### å¸¦æƒé™ (Scopes) çš„è®¿é—®ä»¤ç‰Œ (Access tokens) \{#access-tokens-with-scopes}

è¦åœ¨ MCP æœåŠ¡å™¨ä¸­å®ç°[åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶ (RBAC)](https://auth.wiki/rbac)ï¼Œä½ çš„æˆæƒ (Authorization) æœåŠ¡å™¨éœ€è¦æ”¯æŒç­¾å‘å¸¦æœ‰æƒé™ (Scopes) çš„è®¿é—®ä»¤ç‰Œ (Access token)ã€‚æƒé™ (Scopes) ä»£è¡¨ç”¨æˆ·è¢«æˆäºˆçš„æƒé™ (Permissions)ã€‚

<Tabs groupId="provider">
<TabItem value="logto" label="Logto">

[Logto](https://logto.io) é€šè¿‡å…¶ API èµ„æºå’Œè§’è‰²åŠŸèƒ½ï¼ˆç¬¦åˆ [RFC 8707: OAuth 2.0 çš„èµ„æºæŒ‡ç¤ºå™¨](https://datatracker.ietf.org/doc/html/rfc8707)ï¼‰æä¾› RBAC æ”¯æŒã€‚è®¾ç½®æ–¹æ³•å¦‚ä¸‹ï¼š

1. ç™»å½• [Logto Console](https://cloud.logto.io)ï¼ˆæˆ–ä½ çš„è‡ªæ‰˜ç®¡ Logto Consoleï¼‰

2. åˆ›å»º API èµ„æºå’Œæƒé™ (Scopes)ï¼š

   - è¿›å…¥â€œAPI èµ„æºâ€
   - åˆ›å»ºä¸€ä¸ªåä¸ºâ€œTodo Managerâ€çš„æ–° API èµ„æº
   - æ·»åŠ ä»¥ä¸‹æƒé™ (Scopes)ï¼š
     - `create:todos`ï¼šâ€œåˆ›å»ºæ–°çš„å¾…åŠäº‹é¡¹â€
     - `read:todos`ï¼šâ€œè¯»å–æ‰€æœ‰å¾…åŠäº‹é¡¹â€
     - `delete:todos`ï¼šâ€œåˆ é™¤ä»»æ„å¾…åŠäº‹é¡¹â€

3. åˆ›å»ºè§’è‰²ï¼ˆæ¨èï¼Œä¾¿äºç®¡ç†ï¼‰ï¼š

   - è¿›å…¥â€œè§’è‰²â€
   - åˆ›å»ºä¸€ä¸ªâ€œAdminâ€è§’è‰²å¹¶åˆ†é…æ‰€æœ‰æƒé™ (Scopes)ï¼ˆ`create:todos`ã€`read:todos`ã€`delete:todos`ï¼‰
   - åˆ›å»ºä¸€ä¸ªâ€œUserâ€è§’è‰²ï¼Œä»…åˆ†é… `create:todos` æƒé™ (Scope)

4. åˆ†é…æƒé™ (Permissions)ï¼š
   - è¿›å…¥â€œç”¨æˆ·â€
   - é€‰æ‹©ä¸€ä¸ªç”¨æˆ·
   - ä½ å¯ä»¥ï¼š
     - åœ¨â€œè§’è‰²â€æ ‡ç­¾é¡µåˆ†é…è§’è‰²ï¼ˆæ¨èï¼‰
     - æˆ–åœ¨â€œæƒé™â€æ ‡ç­¾é¡µç›´æ¥åˆ†é…æƒé™ (Scopes)

è¿™äº›æƒé™ (Scopes) ä¼šä½œä¸ºç©ºæ ¼åˆ†éš”çš„å­—ç¬¦ä¸²åŒ…å«åœ¨ JWT è®¿é—®ä»¤ç‰Œ (Access token) çš„ `scope` å£°æ˜ (Claim) ä¸­ã€‚

</TabItem>
<TabItem value="oauth-oidc" label="OAuth 2.0 / OIDC">

OAuth 2.0 / OIDC æä¾›å•†é€šå¸¸æ”¯æŒåŸºäºæƒé™ (Scope) çš„è®¿é—®æ§åˆ¶ã€‚åœ¨å®ç° RBAC æ—¶ï¼š

1. åœ¨æˆæƒ (Authorization) æœåŠ¡å™¨ä¸­å®šä¹‰æ‰€éœ€çš„æƒé™ (Scopes)
2. é…ç½®å®¢æˆ·ç«¯åœ¨æˆæƒ (Authorization) æµç¨‹ä¸­è¯·æ±‚è¿™äº›æƒé™ (Scopes)
3. ç¡®ä¿æˆæƒ (Authorization) æœåŠ¡å™¨åœ¨è®¿é—®ä»¤ç‰Œ (Access token) ä¸­åŒ…å«å·²æˆäºˆçš„æƒé™ (Scopes)
4. æƒé™ (Scopes) é€šå¸¸åŒ…å«åœ¨ JWT è®¿é—®ä»¤ç‰Œ (Access token) çš„ `scope` å£°æ˜ (Claim) ä¸­

è¯·æŸ¥é˜…ä½ çš„æä¾›å•†æ–‡æ¡£ï¼Œäº†è§£ä»¥ä¸‹å†…å®¹ï¼š

- å¦‚ä½•å®šä¹‰å’Œç®¡ç†æƒé™ (Scopes)
- æƒé™ (Scopes) å¦‚ä½•åŒ…å«åœ¨è®¿é—®ä»¤ç‰Œ (Access token) ä¸­
- æ˜¯å¦æœ‰é¢å¤–çš„ RBAC åŠŸèƒ½ï¼Œå¦‚è§’è‰²ç®¡ç†

</TabItem>
</Tabs>

### éªŒè¯ä»¤ç‰Œå¹¶æ£€æŸ¥æƒé™ (Permissions) \{#validating-tokens-and-checking-permissions}

å½“ä½ çš„ MCP æœåŠ¡å™¨æ”¶åˆ°è¯·æ±‚æ—¶ï¼Œéœ€è¦ï¼š

1. éªŒè¯è®¿é—®ä»¤ç‰Œ (Access token) çš„ç­¾åå’Œè¿‡æœŸæ—¶é—´
2. ä»å·²éªŒè¯çš„ä»¤ç‰Œä¸­æå–æƒé™ (Scopes)
3. æ£€æŸ¥ä»¤ç‰Œæ˜¯å¦åŒ…å«æ‰€è¯·æ±‚æ“ä½œæ‰€éœ€çš„æƒé™ (Scopes)

ä¾‹å¦‚ï¼Œå¦‚æœç”¨æˆ·æƒ³åˆ›å»ºæ–°çš„å¾…åŠäº‹é¡¹ï¼Œä»–ä»¬çš„è®¿é—®ä»¤ç‰Œ (Access token) å¿…é¡»åŒ…å« `create:todos` æƒé™ (Scope)ã€‚æµç¨‹å¦‚ä¸‹ï¼š

```mermaid
sequenceDiagram
    participant Client
    participant MCP Server
    participant Auth Server

    Client->>MCP Server: æºå¸¦è®¿é—®ä»¤ç‰Œ (Access token) çš„è¯·æ±‚

    alt JWT éªŒè¯
        MCP Server->>Auth Server: è·å– JWKS
        Auth Server-->>MCP Server: è¿”å› JWKS
        MCP Server->>MCP Server: æœ¬åœ°éªŒè¯ JWT
    else ä»¤ç‰Œè‡ªçœ
        MCP Server->>Auth Server: POST /introspect<br/>(token=access_token)
        Auth Server-->>MCP Server: è¿”å›ä»¤ç‰Œä¿¡æ¯<br/>(active, scope, ç­‰)
    end

    MCP Server->>MCP Server: æå–å¹¶æ£€æŸ¥æƒé™ (Scopes)

    alt æ‹¥æœ‰æ‰€éœ€æƒé™ (Scopes)
        MCP Server->>Client: å…è®¸æ“ä½œ
    else ç¼ºå°‘æƒé™ (Scopes)
        MCP Server->>Client: è¿”å› 403 ç¦æ­¢è®¿é—®
    end
```

### åŠ¨æ€å®¢æˆ·ç«¯æ³¨å†Œ (Dynamic Client Registration) \{#dynamic-client-registration}

æœ¬æ•™ç¨‹ä¸è¦æ±‚åŠ¨æ€å®¢æˆ·ç«¯æ³¨å†Œ (Dynamic Client Registration)ï¼Œä½†å¦‚æœä½ æƒ³è‡ªåŠ¨åŒ– MCP å®¢æˆ·ç«¯åœ¨æˆæƒ (Authorization) æœåŠ¡å™¨çš„æ³¨å†Œæµç¨‹ï¼Œå¯ä»¥å‚è€ƒ [æ˜¯å¦éœ€è¦åŠ¨æ€å®¢æˆ·ç«¯æ³¨å†Œï¼Ÿ](../../provider-list#is-dcr-required)ã€‚

## äº†è§£å¾…åŠäº‹é¡¹ç®¡ç†å™¨ä¸­çš„ RBAC \{#understand-rbac-in-todo-manager}

ä¸ºäº†æ¼”ç¤ºï¼Œæˆ‘ä»¬å°†åœ¨å¾…åŠäº‹é¡¹ç®¡ç†å™¨ MCP æœåŠ¡å™¨ä¸­å®ç°ä¸€ä¸ªç®€å•çš„åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶ (RBAC) ç³»ç»Ÿã€‚è¿™å°†å‘ä½ å±•ç¤º RBAC çš„åŸºæœ¬åŸç†ï¼ŒåŒæ—¶ä¿æŒå®ç°ç®€æ´ã€‚

:::note
è™½ç„¶æœ¬æ•™ç¨‹æ¼”ç¤ºäº†åŸºäº RBAC çš„æƒé™ (Scope) ç®¡ç†ï¼Œä½†éœ€è¦æ³¨æ„ï¼Œå¹¶éæ‰€æœ‰è®¤è¯ (Authentication) æä¾›å•†éƒ½é€šè¿‡è§’è‰²å®ç°æƒé™ (Scope) ç®¡ç†ã€‚æœ‰äº›æä¾›å•†å¯èƒ½æœ‰è‡ªå·±ç‹¬ç‰¹çš„è®¿é—®æ§åˆ¶å’Œæƒé™ (Permission) ç®¡ç†æœºåˆ¶ã€‚
:::

### å·¥å…·ä¸æƒé™ (Scopes) \{#tools-and-scopes}

æˆ‘ä»¬çš„å¾…åŠäº‹é¡¹ç®¡ç†å™¨ MCP æœåŠ¡å™¨æä¾›ä¸‰ä¸ªä¸»è¦å·¥å…·ï¼š

- `create-todo`ï¼šåˆ›å»ºæ–°çš„å¾…åŠäº‹é¡¹
- `get-todos`ï¼šåˆ—å‡ºæ‰€æœ‰å¾…åŠäº‹é¡¹
- `delete-todo`ï¼šæŒ‰ ID åˆ é™¤å¾…åŠäº‹é¡¹

ä¸ºäº†æ§åˆ¶å¯¹è¿™äº›å·¥å…·çš„è®¿é—®ï¼Œæˆ‘ä»¬å®šä¹‰ä»¥ä¸‹æƒé™ (Scopes)ï¼š

- `create:todos`ï¼šå…è®¸åˆ›å»ºæ–°çš„å¾…åŠäº‹é¡¹
- `delete:todos`ï¼šå…è®¸åˆ é™¤ç°æœ‰å¾…åŠäº‹é¡¹
- `read:todos`ï¼šå…è®¸æŸ¥è¯¢å’Œè·å–æ‰€æœ‰å¾…åŠäº‹é¡¹åˆ—è¡¨

### è§’è‰²ä¸æƒé™ (Roles and permissions) \{#roles-and-permissions}

æˆ‘ä»¬å°†å®šä¹‰ä¸¤ä¸ªå…·æœ‰ä¸åŒè®¿é—®çº§åˆ«çš„è§’è‰²ï¼š

| è§’è‰² (Role)  | create:todos | read:todos | delete:todos |
| ----- | ------------ | ---------- | ------------ |
| Admin | âœ…           | âœ…         | âœ…           |
| User  | âœ…           |            |              |

- **User**ï¼šæ™®é€šç”¨æˆ·ï¼Œå¯ä»¥åˆ›å»ºå¾…åŠäº‹é¡¹ï¼Œå¹¶ä¸”åªèƒ½æŸ¥çœ‹æˆ–åˆ é™¤è‡ªå·±çš„å¾…åŠäº‹é¡¹
- **Admin**ï¼šç®¡ç†å‘˜ï¼Œå¯ä»¥åˆ›å»ºã€æŸ¥çœ‹å’Œåˆ é™¤æ‰€æœ‰å¾…åŠäº‹é¡¹ï¼Œæ— è®ºå½’å±è°

### èµ„æºå½’å± (Resource ownership) \{#resource-ownership}

è™½ç„¶ä¸Šè¡¨æ˜¾ç¤ºäº†æ¯ä¸ªè§’è‰²æ˜ç¡®åˆ†é…çš„æƒé™ (Scopes)ï¼Œä½†è¿˜æœ‰ä¸€ä¸ªé‡è¦çš„èµ„æºå½’å±åŸåˆ™ï¼š

- **User** æ²¡æœ‰ `read:todos` æˆ– `delete:todos` æƒé™ (Scopes)ï¼Œä½†ä»–ä»¬ä»ç„¶å¯ä»¥ï¼š
  - æŸ¥çœ‹è‡ªå·±çš„å¾…åŠäº‹é¡¹
  - åˆ é™¤è‡ªå·±çš„å¾…åŠäº‹é¡¹
- **Admin** æ‹¥æœ‰å…¨éƒ¨æƒé™ (`read:todos` å’Œ `delete:todos`)ï¼Œå¯ä»¥ï¼š
  - æŸ¥çœ‹ç³»ç»Ÿä¸­æ‰€æœ‰å¾…åŠäº‹é¡¹
  - åˆ é™¤ä»»æ„å¾…åŠäº‹é¡¹ï¼Œæ— è®ºå½’å±è°

è¿™å±•ç¤ºäº† RBAC ç³»ç»Ÿä¸­çš„å¸¸è§æ¨¡å¼ï¼šèµ„æºå½’å±ä¸ºç”¨æˆ·è‡ªå·±çš„èµ„æºéšå¼æˆäºˆæƒé™ (Permission)ï¼Œè€Œç®¡ç†å‘˜è§’è‰²åˆ™è·å¾—æ‰€æœ‰èµ„æºçš„æ˜¾å¼æƒé™ (Permission)ã€‚

:::tip äº†è§£æ›´å¤š
æƒ³æ·±å…¥äº†è§£ RBAC æ¦‚å¿µå’Œæœ€ä½³å®è·µï¼Œè¯·æŸ¥é˜… [ç²¾é€š RBACï¼šä¸€ä¸ªå…¨é¢çš„çœŸå®æ¡ˆä¾‹](https://blog.logto.io/mastering-rbac)ã€‚
:::

## åœ¨ä½ çš„æä¾›å•†ä¸­é…ç½®æˆæƒ (Authorization) \{#configure-authorization-in-your-provider}

è¦å®ç°æˆ‘ä»¬å‰é¢æè¿°çš„è®¿é—®æ§åˆ¶ç³»ç»Ÿï¼Œä½ éœ€è¦åœ¨æˆæƒ (Authorization) æœåŠ¡å™¨ä¸­é…ç½®æ‰€éœ€çš„æƒé™ (Scopes)ã€‚ä¸åŒæä¾›å•†çš„é…ç½®æ–¹æ³•å¦‚ä¸‹ï¼š

<Tabs groupId="provider">
<TabItem value="logto" label="Logto">

[Logto](https://logto.io) é€šè¿‡å…¶ API èµ„æºå’Œè§’è‰²åŠŸèƒ½æä¾› RBAC æ”¯æŒã€‚è®¾ç½®æ–¹æ³•å¦‚ä¸‹ï¼š

1. ç™»å½• [Logto Console](https://cloud.logto.io)ï¼ˆæˆ–ä½ çš„è‡ªæ‰˜ç®¡ Logto Consoleï¼‰

2. åˆ›å»º API èµ„æºå’Œæƒé™ (Scopes)ï¼š

   - è¿›å…¥â€œAPI èµ„æºâ€
   - åˆ›å»ºä¸€ä¸ªåä¸ºâ€œTodo Managerâ€çš„æ–° API èµ„æºï¼Œå¹¶ä½¿ç”¨ `https://todo.mcp-server.app`ï¼ˆä»…ä½œæ¼”ç¤ºï¼‰ä½œä¸ºæŒ‡ç¤ºå™¨ã€‚
   - åˆ›å»ºä»¥ä¸‹æƒé™ (Scopes)ï¼š
     - `create:todos`ï¼šâ€œåˆ›å»ºæ–°çš„å¾…åŠäº‹é¡¹â€
     - `read:todos`ï¼šâ€œè¯»å–æ‰€æœ‰å¾…åŠäº‹é¡¹â€
     - `delete:todos`ï¼šâ€œåˆ é™¤ä»»æ„å¾…åŠäº‹é¡¹â€

3. åˆ›å»ºè§’è‰²ï¼ˆæ¨èï¼Œä¾¿äºç®¡ç†ï¼‰ï¼š

   - è¿›å…¥â€œè§’è‰²â€
   - åˆ›å»ºä¸€ä¸ªâ€œAdminâ€è§’è‰²å¹¶åˆ†é…æ‰€æœ‰æƒé™ (Scopes)ï¼ˆ`create:todos`ã€`read:todos`ã€`delete:todos`ï¼‰
   - åˆ›å»ºä¸€ä¸ªâ€œUserâ€è§’è‰²ï¼Œä»…åˆ†é… `create:todos` æƒé™ (Scope)
   - åœ¨â€œUserâ€è§’è‰²è¯¦æƒ…é¡µï¼Œåˆ‡æ¢åˆ°â€œå¸¸è§„â€æ ‡ç­¾ï¼Œå¹¶å°†â€œUserâ€è§’è‰²è®¾ç½®ä¸ºâ€œé»˜è®¤è§’è‰²â€ã€‚

4. ç®¡ç†ç”¨æˆ·è§’è‰²å’Œæƒé™ (Permissions)ï¼š
   - æ–°ç”¨æˆ·ï¼š
     - ç”±äºæˆ‘ä»¬è®¾ç½®äº†é»˜è®¤è§’è‰²ï¼Œä»–ä»¬ä¼šè‡ªåŠ¨è·å¾—â€œUserâ€è§’è‰²
   - å·²æœ‰ç”¨æˆ·ï¼š
     - è¿›å…¥â€œç”¨æˆ·ç®¡ç†â€
     - é€‰æ‹©ä¸€ä¸ªç”¨æˆ·
     - åœ¨â€œè§’è‰²â€æ ‡ç­¾é¡µä¸ºç”¨æˆ·åˆ†é…è§’è‰²

:::tip ç¼–ç¨‹æ–¹å¼ç®¡ç†è§’è‰²
ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ Logto çš„ [Management API](https://docs.logto.io/integrate-logto/interact-with-management-api) ä»¥ç¼–ç¨‹æ–¹å¼ç®¡ç†ç”¨æˆ·è§’è‰²ã€‚è¿™å¯¹äºè‡ªåŠ¨åŒ–ç”¨æˆ·ç®¡ç†æˆ–æ„å»ºç®¡ç†é¢æ¿ç‰¹åˆ«æœ‰ç”¨ã€‚
:::

è¯·æ±‚è®¿é—®ä»¤ç‰Œ (Access token) æ—¶ï¼ŒLogto ä¼šæ ¹æ®ç”¨æˆ·è§’è‰²æƒé™ (Permissions) åœ¨ä»¤ç‰Œçš„ `scope` å£°æ˜ (Claim) ä¸­åŒ…å«ç›¸åº”æƒé™ (Scopes)ã€‚

</TabItem>
<TabItem value="keycloak" label="Keycloak">

åœ¨ [Keycloak](https://www.keycloak.org) ä¸­ï¼Œä½ å¯ä»¥é€šè¿‡å®¢æˆ·ç«¯æƒé™ (Client scopes) è®¾ç½®æ‰€éœ€çš„æƒé™ (Permissions)ï¼š

1. åˆ›å»ºå®¢æˆ·ç«¯æƒé™ (Client scopes)ï¼š

   - åœ¨ä½ çš„ realm ä¸­ï¼Œè¿›å…¥â€œå®¢æˆ·ç«¯æƒé™ (Client scopes)â€
   - åˆ›å»ºä¸‰ä¸ªæ–°çš„å®¢æˆ·ç«¯æƒé™ (Client scopes)ï¼š
     - `create:todos`
     - `read:todos`
     - `delete:todos`

2. é…ç½®å®¢æˆ·ç«¯ï¼š

   - è¿›å…¥ä½ çš„å®¢æˆ·ç«¯è®¾ç½®
   - åœ¨â€œå®¢æˆ·ç«¯æƒé™ (Client scopes)â€æ ‡ç­¾é¡µæ·»åŠ ä½ åˆ›å»ºçš„æ‰€æœ‰æƒé™ (Scopes)
   - ç¡®ä¿ä»¤ç‰Œæ˜ å°„å™¨å·²é…ç½®ä¸ºåŒ…å«æƒé™ (Scopes)

3. å¯é€‰ï¼šä½¿ç”¨è§’è‰²ä¾¿äºç®¡ç†
   - å¦‚æœä½ æ›´å–œæ¬¢åŸºäºè§’è‰²çš„ç®¡ç†ï¼š
     - ä¸ºä¸åŒè®¿é—®çº§åˆ«åˆ›å»º realm è§’è‰²
     - å°†æƒé™ (Scopes) æ˜ å°„åˆ°è§’è‰²
     - ä¸ºç”¨æˆ·åˆ†é…è§’è‰²
   - å¦åˆ™ï¼Œä½ å¯ä»¥ç›´æ¥ä¸ºç”¨æˆ·åˆ†é…æƒé™ (Scopes) æˆ–é€šè¿‡å®¢æˆ·ç«¯çº§æƒé™ (Client-level permissions)

Keycloak ä¼šåœ¨è®¿é—®ä»¤ç‰Œ (Access token) çš„ `scope` å£°æ˜ (Claim) ä¸­åŒ…å«å·²æˆäºˆçš„æƒé™ (Scopes)ã€‚

</TabItem>
<TabItem value="oauth-or-oidc" label="OAuth 2 / OIDC">

å¯¹äº OAuth 2.0 æˆ– OpenID Connect æä¾›å•†ï¼Œä½ éœ€è¦é…ç½®ä»£è¡¨ä¸åŒæƒé™ (Permissions) çš„æƒé™ (Scopes)ã€‚å…·ä½“æ­¥éª¤å–å†³äºä½ çš„æä¾›å•†ï¼Œä½†ä¸€èˆ¬æµç¨‹å¦‚ä¸‹ï¼š

1. å®šä¹‰æƒé™ (Scopes)ï¼š

   - é…ç½®ä½ çš„æˆæƒ (Authorization) æœåŠ¡å™¨æ”¯æŒï¼š
     - `create:todos`
     - `read:todos`
     - `delete:todos`

2. é…ç½®å®¢æˆ·ç«¯ï¼š

   - æ³¨å†Œæˆ–æ›´æ–°ä½ çš„å®¢æˆ·ç«¯ä»¥è¯·æ±‚è¿™äº›æƒé™ (Scopes)
   - ç¡®ä¿æƒé™ (Scopes) è¢«åŒ…å«åœ¨è®¿é—®ä»¤ç‰Œ (Access token) ä¸­

3. åˆ†é…æƒé™ (Permissions)ï¼š
   - ä½¿ç”¨ä½ çš„æä¾›å•†ç•Œé¢ä¸ºç”¨æˆ·æˆäºˆç›¸åº”æƒé™ (Scopes)
   - æœ‰äº›æä¾›å•†æ”¯æŒåŸºäºè§’è‰²çš„ç®¡ç†ï¼Œå…¶ä»–åˆ™ä½¿ç”¨ç›´æ¥åˆ†é…æƒé™ (Scopes)
   - æŸ¥é˜…ä½ çš„æä¾›å•†æ–‡æ¡£ï¼Œäº†è§£æ¨èåšæ³•

:::tip
å¤§å¤šæ•°æä¾›å•†ä¼šåœ¨è®¿é—®ä»¤ç‰Œ (Access token) çš„ `scope` å£°æ˜ (Claim) ä¸­åŒ…å«å·²æˆäºˆçš„æƒé™ (Scopes)ã€‚æ ¼å¼é€šå¸¸æ˜¯ç©ºæ ¼åˆ†éš”çš„æƒé™ (Scope) å­—ç¬¦ä¸²ã€‚
:::

</TabItem>
</Tabs>

é…ç½®å¥½æˆæƒ (Authorization) æœåŠ¡å™¨åï¼Œç”¨æˆ·å°†è·å¾—åŒ…å«å…¶å·²æˆäºˆæƒé™ (Scopes) çš„è®¿é—®ä»¤ç‰Œ (Access token)ã€‚MCP æœåŠ¡å™¨å°†ä½¿ç”¨è¿™äº›æƒé™ (Scopes) æ¥åˆ¤æ–­ï¼š

- ç”¨æˆ·æ˜¯å¦å¯ä»¥åˆ›å»ºæ–°çš„å¾…åŠäº‹é¡¹ï¼ˆ`create:todos`ï¼‰
- ç”¨æˆ·æ˜¯å¦å¯ä»¥æŸ¥çœ‹æ‰€æœ‰å¾…åŠäº‹é¡¹ï¼ˆ`read:todos`ï¼‰æˆ–ä»…æŸ¥çœ‹è‡ªå·±çš„
- ç”¨æˆ·æ˜¯å¦å¯ä»¥åˆ é™¤ä»»æ„å¾…åŠäº‹é¡¹ï¼ˆ`delete:todos`ï¼‰æˆ–ä»…åˆ é™¤è‡ªå·±çš„

## æ­å»º MCP æœåŠ¡å™¨ \{#set-up-the-mcp-server}

æˆ‘ä»¬å°†ä½¿ç”¨ [MCP å®˜æ–¹ SDK](https://github.com/modelcontextprotocol) åˆ›å»ºæˆ‘ä»¬çš„å¾…åŠäº‹é¡¹ç®¡ç†å™¨ MCP æœåŠ¡å™¨ã€‚

### åˆ›å»ºæ–°é¡¹ç›® \{#create-a-new-project}

<Tabs groupId="sdk">
<TabItem value="python" label="Python">

```bash
mkdir mcp-server
cd mcp-server
uv init # æˆ–ä½¿ç”¨ `pipenv` æˆ– `poetry` åˆ›å»ºæ–°çš„è™šæ‹Ÿç¯å¢ƒ
```

</TabItem>
<TabItem value="node" label="Node.js">

åˆ›å»ºä¸€ä¸ªæ–°çš„ Node.js é¡¹ç›®ï¼š

```bash
mkdir mcp-server
cd mcp-server
npm init -y # æˆ–ä½¿ç”¨ `pnpm init`
npm pkg set type="module"
npm pkg set main="todo-manager.ts"
npm pkg set scripts.start="node --experimental-strip-types todo-manager.ts"
```

:::note
æˆ‘ä»¬çš„ç¤ºä¾‹ä½¿ç”¨ TypeScriptï¼Œå› ä¸º Node.js v22.6.0+ åŸç”Ÿæ”¯æŒ `--experimental-strip-types` è¿è¡Œ TypeScriptã€‚å¦‚æœä½ ä½¿ç”¨ JavaScriptï¼Œä»£ç ç±»ä¼¼â€”â€”åªéœ€ç¡®ä¿ Node.js ç‰ˆæœ¬ä¸º v22.6.0 æˆ–æ›´é«˜ã€‚è¯¦æƒ…è§ Node.js å®˜æ–¹æ–‡æ¡£ã€‚
:::

</TabItem>
</Tabs>

### å®‰è£… MCP SDK åŠä¾èµ– \{#install-the-mcp-sdk-and-dependencies}

<Tabs groupId="sdk">
<TabItem value="python" label="Python">

```bash
pip install "mcp[cli]" starlette uvicorn
```

æˆ–ä½¿ç”¨ä½ å–œæ¬¢çš„åŒ…ç®¡ç†å™¨ï¼Œå¦‚ `uv` æˆ– `poetry`ã€‚

</TabItem>
<TabItem value="node" label="Node.js">

```bash
npm install @modelcontextprotocol/sdk express zod
```

æˆ–ä½¿ç”¨ä½ å–œæ¬¢çš„åŒ…ç®¡ç†å™¨ï¼Œå¦‚ `pnpm` æˆ– `yarn`ã€‚

</TabItem>
</Tabs>

### åˆ›å»º MCP æœåŠ¡å™¨ \{#create-the-mcp-server}

é¦–å…ˆï¼Œè®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªå¸¦æœ‰å·¥å…·å®šä¹‰çš„åŸºç¡€ MCP æœåŠ¡å™¨ï¼š

<Tabs groupId="sdk">
<TabItem value="python" label="Python">

åˆ›å»ºåä¸º `todo-manager.py` çš„æ–‡ä»¶ï¼Œå¹¶æ·»åŠ å¦‚ä¸‹ä»£ç ï¼š

```python
from typing import Any
from mcp.server.fastmcp import FastMCP
from starlette.applications import Starlette
from starlette.routing import Mount

mcp = FastMCP("Todo Manager")

@mcp.tool()
def create_todo(content: str) -> dict[str, Any]:
    """Create a new todo."""
    return {"error": "Not implemented"}

@mcp.tool()
def get_todos() -> dict[str, Any]:
    """List all todos."""
    return {"error": "Not implemented"}

@mcp.tool()
def delete_todo(id: str) -> dict[str, Any]:
    """Delete a todo by id."""
    return {"error": "Not implemented"}

app = Starlette(
    routes=[Mount('/', app=mcp.sse_app())]
)
```

è¿è¡ŒæœåŠ¡å™¨ï¼š

```bash
uvicorn todo_manager:app --host 0.0.0.0 --port 3001
```

</TabItem>
<TabItem value="node" label="Node.js">

:::note
ç”±äºå½“å‰ MCP inspector å®ç°å°šæœªå¤„ç†æˆæƒ (Authorization) æµç¨‹ï¼Œæˆ‘ä»¬å°†é‡‡ç”¨ SSE æ–¹å¼æ­å»º MCP æœåŠ¡å™¨ã€‚å¾… MCP inspector æ”¯æŒæˆæƒ (Authorization) æµç¨‹åï¼Œæˆ‘ä»¬ä¼šæ›´æ–°æ­¤å¤„ä»£ç ã€‚
:::

ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ `pnpm` æˆ– `yarn`ã€‚

åˆ›å»ºåä¸º `todo-manager.ts` çš„æ–‡ä»¶ï¼Œå¹¶æ·»åŠ å¦‚ä¸‹ä»£ç ï¼š

```ts
// todo-manager.ts

import { z } from 'zod';
import { McpServer } from '@modelcontextprotocol/sdk/server/mcp.js';
import { SSEServerTransport } from '@modelcontextprotocol/sdk/server/sse.js';
import express from 'express';

// åˆ›å»º MCP æœåŠ¡å™¨
const server = new McpServer({
  name: 'Todo Manager',
  version: '0.0.0',
});

server.tool('create-todo', 'Create a new todo', { content: z.string() }, async ({ content }) => {
  return {
    content: [{ type: 'text', text: JSON.stringify({ error: 'Not implemented' }) }],
  };
});

server.tool('get-todos', 'List all todos', async () => {
  return {
    content: [{ type: 'text', text: JSON.stringify({ error: 'Not implemented' }) }],
  };
});

server.tool('delete-todo', 'Delete a todo by id', { id: z.string() }, async ({ id }) => {
  return {
    content: [{ type: 'text', text: JSON.stringify({ error: 'Not implemented' }) }],
  };
});

// ä»¥ä¸‹ä¸º MCP SDK æ–‡æ¡£ä¸­çš„æ ·æ¿ä»£ç 
const PORT = 3001;
const app = express();

const transports = {};

app.get('/sse', async (_req, res) => {
  const transport = new SSEServerTransport('/messages', res);
  transports[transport.sessionId] = transport;

  res.on('close', () => {
    delete transports[transport.sessionId];
  });

  await server.connect(transport);
});

app.post('/messages', async (req, res) => {
  const sessionId = String(req.query.sessionId);
  const transport = transports[sessionId];
  if (transport) {
    await transport.handlePostMessage(req, res, req.body);
  } else {
    res.status(400).send('No transport found for sessionId');
  }
});

app.listen(PORT);
```

è¿è¡ŒæœåŠ¡å™¨ï¼š

```bash
npm start
```

</TabItem>
</Tabs>

## æ£€æŸ¥ MCP æœåŠ¡å™¨ \{#inspect-the-mcp-server}

### å…‹éš†å¹¶è¿è¡Œ MCP inspector \{#clone-and-run-mcp-inspector}

ç°åœ¨ MCP æœåŠ¡å™¨å·²è¿è¡Œï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ MCP inspector æ£€æŸ¥ `whoami` å·¥å…·æ˜¯å¦å¯ç”¨ã€‚

ç”±äºå½“å‰å®ç°çš„é™åˆ¶ï¼Œæˆ‘ä»¬ fork äº† [MCP inspector](https://github.com/mcp-auth/inspector)ï¼Œä½¿å…¶åœ¨è®¤è¯ (Authentication) å’Œæˆæƒ (Authorization) æ–¹é¢æ›´çµæ´»ã€æ›´æ˜“æ‰©å±•ã€‚æˆ‘ä»¬ä¹Ÿå·²å‘åŸä»“åº“æäº¤äº† pull requestã€‚

è¿è¡Œ MCP inspectorï¼š

```bash
git clone https://github.com/mcp-auth/inspector.git
cd inspector
npm install
npm run dev
```

ç„¶ååœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ `http://localhost:6274/`ï¼ˆæˆ–ç»ˆç«¯æ˜¾ç¤ºçš„å…¶ä»– URLï¼‰è®¿é—® MCP inspectorã€‚

### è¿æ¥ MCP inspector åˆ° MCP æœåŠ¡å™¨ \{#connect-mcp-inspector-to-the-mcp-server}

åœ¨ç»§ç»­ä¹‹å‰ï¼Œè¯·æ£€æŸ¥ MCP inspector çš„ä»¥ä¸‹é…ç½®ï¼š

- **Transport Type**ï¼šè®¾ç½®ä¸º `SSE`ã€‚
- **URL**ï¼šè®¾ç½®ä¸ºä½ çš„ MCP æœåŠ¡å™¨åœ°å€ï¼Œæœ¬ä¾‹ä¸º `http://localhost:3001/sse`ã€‚

ç°åœ¨ä½ å¯ä»¥ç‚¹å‡»â€œConnectâ€æŒ‰é’®ï¼ŒæŸ¥çœ‹ MCP inspector æ˜¯å¦èƒ½è¿æ¥ MCP æœåŠ¡å™¨ã€‚å¦‚æœä¸€åˆ‡æ­£å¸¸ï¼Œä½ å°†åœ¨ MCP inspector ä¸­çœ‹åˆ°â€œConnectedâ€çŠ¶æ€ã€‚

### æ£€æŸ¥ç‚¹ï¼šè¿è¡Œå¾…åŠäº‹é¡¹ç®¡ç†å·¥å…· \{#checkpoint-run-todo-manager-tools}

1. åœ¨ MCP inspector é¡¶éƒ¨èœå•ç‚¹å‡»â€œToolsâ€æ ‡ç­¾ã€‚
2. ç‚¹å‡»â€œList Toolsâ€æŒ‰é’®ã€‚
3. ä½ åº”è¯¥èƒ½åœ¨é¡µé¢ä¸Šçœ‹åˆ° `create-todo`ã€`get-todos` å’Œ `delete-todo` å·¥å…·ã€‚ç‚¹å‡»å¯æŸ¥çœ‹å·¥å…·è¯¦æƒ…ã€‚
4. ä½ å°†åœ¨å³ä¾§çœ‹åˆ°â€œRun Toolâ€æŒ‰é’®ã€‚ç‚¹å‡»å¹¶è¾“å…¥æ‰€éœ€å‚æ•°è¿è¡Œå·¥å…·ã€‚
5. ä½ å°†çœ‹åˆ°å·¥å…·è¿”å›çš„ JSON å“åº” `{"error": "Not implemented"}`ã€‚

![MCP inspector é¦–æ¬¡è¿è¡Œ](/docs-assets/images/tutorials/todo-manager/inspector-first-run.png)

## é›†æˆä½ çš„æˆæƒ (Authorization) æœåŠ¡å™¨ \{#integrate-with-your-authorization-server}

å®Œæˆæœ¬èŠ‚éœ€è¦è€ƒè™‘ä»¥ä¸‹äº‹é¡¹ï¼š

<details>
<summary>**ä½ çš„æˆæƒ (Authorization) æœåŠ¡å™¨çš„å‘è¡Œè€… (Issuer) URL**</summary>

é€šå¸¸æ˜¯ä½ çš„æˆæƒ (Authorization) æœåŠ¡å™¨çš„åŸºç¡€ URLï¼Œå¦‚ `https://auth.example.com`ã€‚æœ‰äº›æä¾›å•†å¯èƒ½æ˜¯ `https://example.logto.app/oidc`ï¼Œè¯·æŸ¥é˜…ä½ çš„æä¾›å•†æ–‡æ¡£ã€‚

</details>

<details>
<summary>**å¦‚ä½•è·å–æˆæƒ (Authorization) æœåŠ¡å™¨å…ƒæ•°æ®**</summary>

- å¦‚æœä½ çš„æˆæƒ (Authorization) æœåŠ¡å™¨ç¬¦åˆ [OAuth 2.0 æˆæƒæœåŠ¡å™¨å…ƒæ•°æ®](https://datatracker.ietf.org/doc/html/rfc8414) æˆ– [OpenID Connect å‘ç°](https://openid.net/specs/openid-connect-discovery-1_0.html)ï¼Œä½ å¯ä»¥ä½¿ç”¨ MCP Auth å†…ç½®å·¥å…·è‡ªåŠ¨è·å–å…ƒæ•°æ®ã€‚
- å¦‚æœä¸ç¬¦åˆè¿™äº›æ ‡å‡†ï¼Œä½ éœ€è¦åœ¨ MCP æœåŠ¡å™¨é…ç½®ä¸­æ‰‹åŠ¨æŒ‡å®šå…ƒæ•°æ® URL æˆ–ç«¯ç‚¹ã€‚è¯·æŸ¥é˜…ä½ çš„æä¾›å•†æ–‡æ¡£ã€‚

</details>

<details>
<summary>**å¦‚ä½•å°† MCP inspector æ³¨å†Œä¸ºæˆæƒ (Authorization) æœåŠ¡å™¨çš„å®¢æˆ·ç«¯**</summary>

- å¦‚æœä½ çš„æˆæƒ (Authorization) æœåŠ¡å™¨æ”¯æŒ [åŠ¨æ€å®¢æˆ·ç«¯æ³¨å†Œ (Dynamic Client Registration)](https://datatracker.ietf.org/doc/html/rfc7591)ï¼Œå¯ä»¥è·³è¿‡æ­¤æ­¥éª¤ï¼ŒMCP inspector ä¼šè‡ªåŠ¨æ³¨å†Œä¸ºå®¢æˆ·ç«¯ã€‚
- å¦‚æœä¸æ”¯æŒåŠ¨æ€å®¢æˆ·ç«¯æ³¨å†Œ (Dynamic Client Registration)ï¼Œä½ éœ€è¦æ‰‹åŠ¨å°† MCP inspector æ³¨å†Œä¸ºå®¢æˆ·ç«¯ã€‚

</details>

<details>
<summary>**äº†è§£ä»¤ç‰Œè¯·æ±‚å‚æ•°**</summary>

å‘ä¸åŒæˆæƒ (Authorization) æœåŠ¡å™¨è¯·æ±‚è®¿é—®ä»¤ç‰Œ (Access token) æ—¶ï¼ŒæŒ‡å®šç›®æ ‡èµ„æºå’Œæƒé™ (Permissions) çš„æ–¹å¼å„å¼‚ã€‚ä¸»è¦æ¨¡å¼å¦‚ä¸‹ï¼š

- **åŸºäºèµ„æºæŒ‡ç¤ºå™¨ (Resource indicator)**ï¼š

  - ä½¿ç”¨ `resource` å‚æ•°æŒ‡å®šç›®æ ‡ APIï¼ˆè§ [RFC 8707: OAuth 2.0 çš„èµ„æºæŒ‡ç¤ºå™¨](https://datatracker.ietf.org/doc/html/rfc8707)ï¼‰
  - ç°ä»£ OAuth 2.0 å®ç°å¸¸ç”¨
  - ç¤ºä¾‹è¯·æ±‚ï¼š
    ```json
    {
      "resource": "https://todo.mcp-server.app",
      "scope": "create:todos read:todos"
    }
    ```
  - æœåŠ¡å™¨ç­¾å‘ä¸“é—¨ç»‘å®šåˆ°è¯·æ±‚èµ„æºçš„ä»¤ç‰Œ

- **åŸºäºå—ä¼— (Audience)**ï¼š

  - ä½¿ç”¨ `audience` å‚æ•°æŒ‡å®šä»¤ç‰Œçš„ç›®æ ‡æ¥æ”¶æ–¹
  - ä¸èµ„æºæŒ‡ç¤ºå™¨ç±»ä¼¼ï¼Œä½†è¯­ä¹‰ä¸åŒ
  - ç¤ºä¾‹è¯·æ±‚ï¼š
    ```json
    {
      "audience": "todo-api",
      "scope": "create:todos read:todos"
    }
    ```

- **çº¯æƒé™ (Scope) æ¨¡å¼**ï¼š
  - ä»…ä¾èµ–æƒé™ (Scopes)ï¼Œæ— èµ„æº/å—ä¼—å‚æ•°
  - ä¼ ç»Ÿ OAuth 2.0 æ–¹å¼
  - ç¤ºä¾‹è¯·æ±‚ï¼š
    ```json
    {
      "scope": "todo-api:create todo-api:read openid profile"
    }
    ```
  - é€šå¸¸ä½¿ç”¨å‰ç¼€æƒé™ (Scopes) è¿›è¡Œå‘½åç©ºé—´éš”ç¦»
  - é€‚ç”¨äºç®€å•çš„ OAuth 2.0 å®ç°

:::tip æœ€ä½³å®è·µ

- æŸ¥é˜…ä½ çš„æä¾›å•†æ–‡æ¡£ï¼Œäº†è§£æ”¯æŒå“ªäº›å‚æ•°
- æœ‰äº›æä¾›å•†åŒæ—¶æ”¯æŒå¤šç§æ–¹å¼
- èµ„æºæŒ‡ç¤ºå™¨ (Resource indicator) é€šè¿‡å—ä¼—é™åˆ¶æå‡å®‰å…¨æ€§
- å¦‚æœ‰æ¡ä»¶ï¼Œä¼˜å…ˆä½¿ç”¨èµ„æºæŒ‡ç¤ºå™¨ (Resource indicator) ä»¥è·å¾—æ›´å¥½çš„è®¿é—®æ§åˆ¶
  :::

</details>

è™½ç„¶æ¯ä¸ªæä¾›å•†å¯èƒ½æœ‰è‡ªå·±çš„å…·ä½“è¦æ±‚ï¼Œä»¥ä¸‹æ­¥éª¤å°†æŒ‡å¯¼ä½ å¦‚ä½•ç»“åˆ MCP inspector å’Œ MCP æœåŠ¡å™¨è¿›è¡Œé’ˆå¯¹ä¸åŒæä¾›å•†çš„é…ç½®ã€‚

### æ³¨å†Œ MCP inspector ä¸ºå®¢æˆ·ç«¯ \{#register-mcp-inspector-as-a-client}

<Tabs groupId="provider">
<TabItem value="logto" label="Logto">

å°†å¾…åŠäº‹é¡¹ç®¡ç†å™¨é›†æˆåˆ° [Logto](https://logto.io) éå¸¸ç®€å•ï¼Œå› ä¸ºå®ƒæ˜¯æ”¯æŒèµ„æºæŒ‡ç¤ºå™¨ (Resource indicator) å’Œæƒé™ (Scopes) çš„ OpenID Connect æä¾›å•†ï¼Œå¯ä»¥ç”¨ `https://todo.mcp-server.app` ä½œä¸ºèµ„æºæŒ‡ç¤ºå™¨ä¿æŠ¤ä½ çš„ todo APIã€‚

ç”±äº Logto ç›®å‰ä¸æ”¯æŒåŠ¨æ€å®¢æˆ·ç«¯æ³¨å†Œ (Dynamic Client Registration)ï¼Œä½ éœ€è¦æ‰‹åŠ¨åœ¨ Logto ç§Ÿæˆ·ä¸­æ³¨å†Œ MCP inspector ä¸ºå®¢æˆ·ç«¯ï¼š

1. æ‰“å¼€ MCP inspectorï¼Œç‚¹å‡» â€œOAuth Configurationâ€ æŒ‰é’®ã€‚å¤åˆ¶ **Redirect URL (auto-populated)**ï¼Œå¦‚ `http://localhost:6274/oauth/callback`ã€‚
2. ç™»å½• [Logto Console](https://cloud.logto.io)ï¼ˆæˆ–ä½ çš„è‡ªæ‰˜ç®¡ Logto Consoleï¼‰ã€‚
3. è¿›å…¥â€œåº”ç”¨ç¨‹åºâ€æ ‡ç­¾ï¼Œç‚¹å‡»â€œåˆ›å»ºåº”ç”¨ç¨‹åºâ€ã€‚åœ¨é¡µé¢åº•éƒ¨ç‚¹å‡»â€œCreate app without frameworkâ€ã€‚
4. å¡«å†™åº”ç”¨è¯¦æƒ…ï¼Œç„¶åç‚¹å‡»â€œåˆ›å»ºåº”ç”¨ç¨‹åºâ€ï¼š
   - **é€‰æ‹©åº”ç”¨ç±»å‹**ï¼šé€‰æ‹©â€œå•é¡µåº”ç”¨ç¨‹åºâ€
   - **åº”ç”¨åç§°**ï¼šå¦‚ â€œMCP Inspectorâ€
5. åœ¨â€œè®¾ç½® / Redirect URIsâ€éƒ¨åˆ†ï¼Œç²˜è´´ä½ ä» MCP inspector å¤åˆ¶çš„ **Redirect URL (auto-populated)**ï¼Œç„¶åç‚¹å‡»åº•éƒ¨æ çš„â€œä¿å­˜æ›´æ”¹â€ã€‚
6. åœ¨é¡¶éƒ¨å¡ç‰‡ä¸­ï¼Œä½ ä¼šçœ‹åˆ° â€œApp IDâ€ å€¼ã€‚å¤åˆ¶å®ƒã€‚
7. å›åˆ° MCP inspectorï¼Œåœ¨ â€œOAuth Configurationâ€ çš„ â€œClient IDâ€ å­—æ®µç²˜è´´ â€œApp IDâ€ã€‚
8. åœ¨ â€œAuth Paramsâ€ å­—æ®µè¾“å…¥ `{"scope": "create:todos read:todos delete:todos", "resource": "https://todo.mcp-server.app"}`ã€‚è¿™æ · Logto è¿”å›çš„è®¿é—®ä»¤ç‰Œ (Access token) å°±åŒ…å«è®¿é—®å¾…åŠäº‹é¡¹ç®¡ç†å™¨æ‰€éœ€çš„æƒé™ (Scopes)ã€‚

</TabItem>
<TabItem value="oauth-oidc" label="OAuth 2.0 / OIDC">

:::note
è¿™æ˜¯é€šç”¨çš„ OAuth 2.0 / OpenID Connect æä¾›å•†é›†æˆæŒ‡å—ã€‚OAuth 2.0 å’Œ OIDC æ­¥éª¤ç±»ä¼¼ï¼Œå› ä¸º OIDC åŸºäº OAuth 2.0ã€‚å…·ä½“ç»†èŠ‚è¯·æŸ¥é˜…ä½ çš„æä¾›å•†æ–‡æ¡£ã€‚
:::

å¦‚æœä½ çš„æä¾›å•†æ”¯æŒåŠ¨æ€å®¢æˆ·ç«¯æ³¨å†Œ (Dynamic Client Registration)ï¼Œå¯ä»¥ç›´æ¥è·³åˆ°ç¬¬ 8 æ­¥é…ç½® MCP inspectorï¼›å¦åˆ™éœ€è¦æ‰‹åŠ¨æ³¨å†Œ MCP inspector ä¸ºå®¢æˆ·ç«¯ï¼š

1. æ‰“å¼€ MCP inspectorï¼Œç‚¹å‡» â€œOAuth Configurationâ€ æŒ‰é’®ã€‚å¤åˆ¶ **Redirect URL (auto-populated)**ï¼Œå¦‚ `http://localhost:6274/oauth/callback`ã€‚

2. ç™»å½•ä½ çš„æä¾›å•†æ§åˆ¶å°ã€‚

3. è¿›å…¥â€œåº”ç”¨ç¨‹åºâ€æˆ–â€œå®¢æˆ·ç«¯â€éƒ¨åˆ†ï¼Œåˆ›å»ºæ–°åº”ç”¨æˆ–å®¢æˆ·ç«¯ã€‚

4. å¦‚æœéœ€è¦é€‰æ‹©å®¢æˆ·ç«¯ç±»å‹ï¼Œé€‰æ‹©â€œå•é¡µåº”ç”¨ç¨‹åºâ€æˆ–â€œå…¬å…±å®¢æˆ·ç«¯â€ã€‚

5. åˆ›å»ºåº”ç”¨åï¼Œéœ€è¦é…ç½®é‡å®šå‘ URIã€‚ç²˜è´´ä½ ä» MCP inspector å¤åˆ¶çš„ **Redirect URL (auto-populated)**ã€‚

6. æ‰¾åˆ°æ–°å»ºåº”ç”¨çš„ â€œClient IDâ€ æˆ– â€œApplication IDâ€ï¼Œå¤åˆ¶å®ƒã€‚

7. å›åˆ° MCP inspectorï¼Œåœ¨ â€œOAuth Configurationâ€ çš„ â€œClient IDâ€ å­—æ®µç²˜è´´ â€œClient IDâ€ã€‚

8. åœ¨ â€œAuth Paramsâ€ å­—æ®µè¾“å…¥ä»¥ä¸‹å†…å®¹ï¼Œè¯·æ±‚å¾…åŠäº‹é¡¹æ“ä½œæ‰€éœ€æƒé™ (Scopes)ï¼š

```json
{ "scope": "create:todos read:todos delete:todos" }
```

</TabItem>
</Tabs>

### é…ç½® MCP Auth \{#set-up-mcp-auth}

åœ¨ä½ çš„ MCP æœåŠ¡å™¨é¡¹ç›®ä¸­ï¼Œéœ€è¦å®‰è£… MCP Auth SDK å¹¶é…ç½®å…¶ä½¿ç”¨ä½ çš„æˆæƒ (Authorization) æœåŠ¡å™¨å…ƒæ•°æ®ã€‚

<Tabs groupId="sdk">
<TabItem value="python" label="Python">

é¦–å…ˆå®‰è£… `mcpauth` åŒ…ï¼š

```bash
pip install mcpauth
```

æˆ–ä½¿ç”¨ä½ å–œæ¬¢çš„åŒ…ç®¡ç†å™¨ï¼Œå¦‚ `uv` æˆ– `poetry`ã€‚

</TabItem>
<TabItem value="node" label="Node.js">

é¦–å…ˆå®‰è£… `mcp-auth` åŒ…ï¼š

```bash
npm install mcp-auth
```

</TabItem>
</Tabs>

MCP Auth éœ€è¦æˆæƒ (Authorization) æœåŠ¡å™¨å…ƒæ•°æ®æ‰èƒ½åˆå§‹åŒ–ã€‚æ ¹æ®ä½ çš„æä¾›å•†ï¼š

<Tabs groupId="provider">

<TabItem value="logto" label="Logto">

å‘è¡Œè€… (Issuer) URL å¯åœ¨ Logto Console çš„åº”ç”¨è¯¦æƒ…é¡µ â€œEndpoints & Credentials / Issuer endpointâ€ éƒ¨åˆ†æ‰¾åˆ°ï¼Œæ ¼å¼å¦‚ `https://my-project.logto.app/oidc`ã€‚

<SetupOidc />

</TabItem>

<TabItem value="oauth-oidc" label="OAuth 2.0 / OIDC">

å¯¹äº OAuth 2.0 æä¾›å•†ï¼Œä½ éœ€è¦ï¼š

1. æŸ¥é˜…ä½ çš„æä¾›å•†æ–‡æ¡£ï¼Œè·å–æˆæƒ (Authorization) æœåŠ¡å™¨ URLï¼ˆé€šå¸¸ç§°ä¸ºå‘è¡Œè€… (Issuer) URL æˆ–åŸºç¡€ URLï¼‰
2. æœ‰äº›æä¾›å•†ä¼šåœ¨ `https://{your-domain}/.well-known/oauth-authorization-server` æš´éœ²æ­¤ä¿¡æ¯
3. åœ¨æä¾›å•†ç®¡ç†åå°çš„ OAuth/API è®¾ç½®ä¸­æŸ¥æ‰¾

<SetupOauthOrOidc />

</TabItem>

</Tabs>

<Tabs groupId="sdk">

<TabItem value="python" label="Python">

æ›´æ–° `todo-manager.py`ï¼ŒåŠ å…¥ MCP Auth é…ç½®ï¼š

```python
from mcpauth import MCPAuth
from mcpauth.config import AuthServerType
from mcpauth.utils import fetch_server_config

auth_issuer = '<issuer-endpoint>'  # æ›¿æ¢ä¸ºä½ çš„å‘è¡Œè€… (Issuer) ç«¯ç‚¹
auth_server_config = fetch_server_config(auth_issuer, type=AuthServerType.OIDC)
mcp_auth = MCPAuth(server=auth_server_config)
```

</TabItem>
<TabItem value="node" label="Node.js">

æ›´æ–° `todo-manager.ts`ï¼ŒåŠ å…¥ MCP Auth é…ç½®ï¼š

```ts
// todo-manager.ts

import { MCPAuth, fetchServerConfig } from 'mcp-auth';

const authIssuer = '<issuer-endpoint>'; // æ›¿æ¢ä¸ºä½ çš„å‘è¡Œè€… (Issuer) ç«¯ç‚¹
const mcpAuth = new MCPAuth({
  server: await fetchServerConfig(authIssuer, { type: 'oidc' }),
});
```

</TabItem>
</Tabs>

### æ›´æ–° MCP æœåŠ¡å™¨ \{#update-mcp-server}

æˆ‘ä»¬å¿«å®Œæˆäº†ï¼ç°åœ¨éœ€è¦æ›´æ–° MCP æœåŠ¡å™¨ï¼Œåº”ç”¨ MCP Auth è·¯ç”±å’Œä¸­é—´ä»¶ï¼Œå¹¶åŸºäºç”¨æˆ·æƒé™ (Scopes) å®ç°å¾…åŠäº‹é¡¹å·¥å…·çš„æƒé™ (Permission) æ§åˆ¶ã€‚

<Tabs groupId="sdk">
<TabItem value="python" label="Python">

```python
@mcp.tool()
def create_todo(content: str) -> dict[str, Any]:
    """Create a new todo."""
    return (
        mcp_auth.auth_info.scopes
        if mcp_auth.auth_info # ç”± Bearer auth ä¸­é—´ä»¶å¡«å……
        else {"error": "Not authenticated"}
    )

# ...

bearer_auth = Middleware(mcp_auth.bearer_auth_middleware("jwt"))
app = Starlette(
    routes=[
        # æ·»åŠ å…ƒæ•°æ®è·¯ç”± (`/.well-known/oauth-authorization-server`)
        mcp_auth.metadata_route(),
        # ç”¨ Bearer auth ä¸­é—´ä»¶ä¿æŠ¤ MCP æœåŠ¡å™¨
        Mount('/', app=mcp.sse_app(), middleware=[bearer_auth]),
    ],
)
```

</TabItem>
<TabItem value="node" label="Node.js">

```js
server.tool(
  'create-todo',
  'Create a new todo',
  { content: z.string() },
  async ({ content, authInfo }) => {
    return {
      content: [
        { type: 'text', text: JSON.stringify(authInfo?.scopes ?? { error: 'Not authenticated' }) },
      ],
    };
  }
);

// ...

app.use(mcpAuth.delegatedRouter());
app.use(mcpAuth.bearerAuth('jwt'));
```

</TabItem>
</Tabs>

æ¥ä¸‹æ¥ï¼Œè®©æˆ‘ä»¬å®ç°å…·ä½“çš„å·¥å…·ã€‚

é¦–å…ˆï¼Œåˆ›å»ºä¸€ä¸ªç®€å•çš„ todo æœåŠ¡ï¼Œåœ¨å†…å­˜ä¸­æä¾›åŸºæœ¬çš„ CRUD æ“ä½œã€‚

<Tabs groupId="sdk">
<TabItem value="python" label="Python">
```python
# service.py

"""
ä¸€ä¸ªç®€å•çš„ Todo æœåŠ¡ï¼Œä»…ç”¨äºæ¼”ç¤ºã€‚
ä½¿ç”¨å†…å­˜åˆ—è¡¨å­˜å‚¨ todosã€‚
"""

from datetime import datetime
from typing import List, Optional, Dict, Any
import random
import string

class Todo:
"""è¡¨ç¤ºä¸€ä¸ªå¾…åŠäº‹é¡¹ã€‚"""

    def __init__(self, id: str, content: str, owner_id: str, created_at: str):
        self.id = id
        self.content = content
        self.owner_id = owner_id
        self.created_at = created_at

    def to_dict(self) -> Dict[str, Any]:
        """å°† todo è½¬ä¸ºå­—å…¸ä»¥ä¾¿ JSON åºåˆ—åŒ–ã€‚"""
        return {
            "id": self.id,
            "content": self.content,
            "ownerId": self.owner_id,
            "createdAt": self.created_at
        }

class TodoService:
"""ä¸€ä¸ªç®€å•çš„ Todo æœåŠ¡ï¼Œä»…ç”¨äºæ¼”ç¤ºã€‚"""

    def __init__(self):
        self._todos: List[Todo] = []

    def get_all_todos(self, owner_id: Optional[str] = None) -> List[Dict[str, Any]]:
        """
        è·å–æ‰€æœ‰ todosï¼Œå¯é€‰æŒ‰ owner_id è¿‡æ»¤ã€‚

        Args:
            owner_id: å¦‚æä¾›ï¼Œä»…è¿”å›è¯¥ç”¨æˆ·æ‹¥æœ‰çš„ todos

        Returns:
            todo å­—å…¸åˆ—è¡¨
        """
        if owner_id:
            filtered_todos = [todo for todo in self._todos if todo.owner_id == owner_id]
            return [todo.to_dict() for todo in filtered_todos]
        return [todo.to_dict() for todo in self._todos]

    def get_todo_by_id(self, todo_id: str) -> Optional[Todo]:
        """
        æŒ‰ ID è·å– todoã€‚

        Args:
            todo_id: è¦è·å–çš„ todo ID

        Returns:
            æ‰¾åˆ°åˆ™è¿”å› Todo å¯¹è±¡ï¼Œå¦åˆ™ä¸º None
        """
        for todo in self._todos:
            if todo.id == todo_id:
                return todo
        return None

    def create_todo(self, content: str, owner_id: str) -> Dict[str, Any]:
        """
        åˆ›å»ºæ–° todoã€‚

        Args:
            content: todo å†…å®¹
            owner_id: æ‹¥æœ‰è¯¥ todo çš„ç”¨æˆ· ID

        Returns:
            åˆ›å»ºçš„ todo å­—å…¸
        """
        todo = Todo(
            id=self._generate_id(),
            content=content,
            owner_id=owner_id,
            created_at=datetime.now().isoformat()
        )
        self._todos.append(todo)
        return todo.to_dict()

    def delete_todo(self, todo_id: str) -> Optional[Dict[str, Any]]:
        """
        æŒ‰ ID åˆ é™¤ todoã€‚

        Args:
            todo_id: è¦åˆ é™¤çš„ todo ID

        Returns:
            åˆ é™¤çš„ todo å­—å…¸ï¼Œå¦‚æœªæ‰¾åˆ°åˆ™ä¸º None
        """
        for i, todo in enumerate(self._todos):
            if todo.id == todo_id:
                deleted_todo = self._todos.pop(i)
                return deleted_todo.to_dict()
        return None

    def _generate_id(self) -> str:
        """ç”Ÿæˆéšæœº todo IDã€‚"""
        return ''.join(random.choices(string.ascii_lowercase + string.digits, k=8))

````


</TabItem>
<TabItem value="node" label="Node.js">

```ts
// todo-service.ts

type Todo = {
  id: string;
  content: string;
  ownerId: string;
  createdAt: string;
};

/**
 * ä¸€ä¸ªç®€å•çš„ Todo æœåŠ¡ï¼Œä»…ç”¨äºæ¼”ç¤ºã€‚
 * ä½¿ç”¨å†…å­˜æ•°ç»„å­˜å‚¨ todos
 */
export class TodoService {
  private readonly todos: Todo[] = [];

  getAllTodos(ownerId?: string): Todo[] {
    if (ownerId) {
      return this.todos.filter((todo) => todo.ownerId === ownerId);
    }
    return this.todos;
  }

  getTodoById(id: string): Todo | undefined {
    return this.todos.find((todo) => todo.id === id);
  }

  createTodo({ content, ownerId }: { content: string; ownerId: string }): Todo {
    const todo: Todo = {
      id: this.genId(),
      content,
      ownerId,
      createdAt: new Date().toISOString(),
    };

    // eslint-disable-next-line @silverhand/fp/no-mutating-methods
    this.todos.push(todo);
    return todo;
  }

  deleteTodo(id: string): Todo | undefined {
    const index = this.todos.findIndex((todo) => todo.id === id);

    if (index === -1) {
      return undefined;
    }

    // eslint-disable-next-line @silverhand/fp/no-mutating-methods
    const [deleted] = this.todos.splice(index, 1);
    return deleted;
  }

  private genId(): string {
    return Math.random().toString(36).slice(2, 10);
  }
}
````

</TabItem>
</Tabs>

ç„¶ååœ¨å·¥å…·å±‚ï¼Œæ ¹æ®ç”¨æˆ·æƒé™ (Scopes) åˆ¤æ–­æ“ä½œæ˜¯å¦å…è®¸ï¼š

<Tabs groupId="sdk">
<TabItem value="python" label="Python">

```python
# todo-manager.py

from typing import Any, Optional
from mcpauth.errors import MCPAuthBearerAuthError

def assert_user_id(auth_info: Optional[dict]) -> str:
    """ä» auth info æå–å¹¶æ ¡éªŒç”¨æˆ· IDã€‚"""
    subject = auth_info.get('subject') if auth_info else None
    if not subject:
        raise ValueError('Invalid auth info')
    return subject

def has_required_scopes(user_scopes: list[str], required_scopes: list[str]) -> bool:
    """æ£€æŸ¥ç”¨æˆ·æ˜¯å¦æ‹¥æœ‰æ‰€æœ‰æ‰€éœ€æƒé™ (Scopes)ã€‚"""
    return all(scope in user_scopes for scope in required_scopes)

# åˆ›å»º TodoService å®ä¾‹
todo_service = TodoService()

@mcp.tool()
def create_todo(content: str) -> dict[str, Any]:
    """åˆ›å»ºæ–° todoã€‚

    åªæœ‰æ‹¥æœ‰ 'create:todos' æƒé™ (Scope) çš„ç”¨æˆ·æ‰èƒ½åˆ›å»º todoã€‚
    """
    # è·å–è®¤è¯ (Authentication) ä¿¡æ¯
    auth_info = mcp_auth.auth_info

    # æ ¡éªŒç”¨æˆ· ID
    try:
        user_id = assert_user_id(auth_info)
    except ValueError as e:
        return {"error": str(e)}

    # æ£€æŸ¥ç”¨æˆ·æ˜¯å¦æœ‰æ‰€éœ€æƒé™ (Permissions)
    if not has_required_scopes(auth_info.scopes if auth_info else [], ['create:todos']):
        raise MCPAuthBearerAuthError('missing_required_scopes')

    # åˆ›å»ºæ–° todo
    created_todo = todo_service.create_todo(content=content, owner_id=user_id)

    # è¿”å›åˆ›å»ºçš„ todo
    return created_todo.__dict__

# ...
```

ä½ å¯ä»¥æŸ¥çœ‹æˆ‘ä»¬çš„ [ç¤ºä¾‹ä»£ç ](https://github.com/mcp-auth/python/tree/master/samples/server) è·å–å…¶ä»–è¯¦ç»†å®ç°ã€‚

</TabItem>
<TabItem value="node" label="Node.js">

```ts
// todo-manager.ts

// ... å…¶ä»–å¯¼å…¥
import assert from 'node:assert';
import { type AuthInfo } from '@modelcontextprotocol/sdk/server/auth/types.js';
import { TodoService } from './todo-service.js';

const todoService = new TodoService();

const assertUserId = (authInfo?: AuthInfo) => {
  const { subject } = authInfo ?? {};
  assert(subject, 'Invalid auth info');
  return subject;
};

/**
 * æ£€æŸ¥ç”¨æˆ·æ˜¯å¦æ‹¥æœ‰æ“ä½œæ‰€éœ€çš„æ‰€æœ‰æƒé™ (Scopes)
 */
const hasRequiredScopes = (userScopes: string[], requiredScopes: string[]): boolean => {
  return requiredScopes.every((scope) => userScopes.includes(scope));
};

server.tool(
  'create-todo',
  'Create a new todo',
  { content: z.string() },
  ({ content }: { content: string }, { authInfo }) => {
    const userId = assertUserId(authInfo);

    /**
     * åªæœ‰æ‹¥æœ‰ 'create:todos' æƒé™ (Scope) çš„ç”¨æˆ·æ‰èƒ½åˆ›å»º todo
     */
    if (!hasRequiredScopes(authInfo?.scopes ?? [], ['create:todos'])) {
      throw new MCPAuthBearerAuthError('missing_required_scopes');
    }

    const createdTodo = todoService.createTodo({ content, ownerId: userId });

    return {
      content: [{ type: 'text', text: JSON.stringify(createdTodo) }],
    };
  }
);

// ...
```

ä½ å¯ä»¥æŸ¥çœ‹æˆ‘ä»¬çš„ [ç¤ºä¾‹ä»£ç ](https://github.com/mcp-auth/js/tree/master/packages/sample-servers/src/todo-manager) è·å–å…¶ä»–è¯¦ç»†å®ç°ã€‚

</TabItem>
</Tabs>

## æ£€æŸ¥ç‚¹ï¼šè¿è¡Œ `todo-manager` å·¥å…· \{#checkpoint-run-the-todo-manager-tools}

é‡å¯ä½ çš„ MCP æœåŠ¡å™¨ï¼Œå¹¶åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ MCP inspectorã€‚ç‚¹å‡»â€œConnectâ€æŒ‰é’®åï¼Œä½ ä¼šè¢«é‡å®šå‘åˆ°æˆæƒ (Authorization) æœåŠ¡å™¨çš„ç™»å½•é¡µé¢ã€‚

ç™»å½•åå›åˆ° MCP inspectorï¼Œé‡å¤ä¸Šä¸€ä¸ªæ£€æŸ¥ç‚¹çš„æ“ä½œè¿è¡Œå¾…åŠäº‹é¡¹ç®¡ç†å·¥å…·ã€‚æ­¤æ—¶ï¼Œä½ å¯ä»¥ç”¨å·²è®¤è¯ (Authentication) çš„ç”¨æˆ·èº«ä»½ä½¿ç”¨è¿™äº›å·¥å…·ã€‚å·¥å…·çš„è¡Œä¸ºå°†æ ¹æ®åˆ†é…ç»™ä½ çš„è§’è‰²å’Œæƒé™ (Permissions) è€Œå˜åŒ–ï¼š

- å¦‚æœä½ ä»¥ **User**ï¼ˆä»…æœ‰ `create:todos` æƒé™ (Scope)ï¼‰èº«ä»½ç™»å½•ï¼š

  - å¯ä»¥ç”¨ `create-todo` å·¥å…·åˆ›å»ºæ–°å¾…åŠäº‹é¡¹
  - åªèƒ½æŸ¥çœ‹å’Œåˆ é™¤è‡ªå·±çš„å¾…åŠäº‹é¡¹
  - æ— æ³•æŸ¥çœ‹æˆ–åˆ é™¤å…¶ä»–ç”¨æˆ·çš„å¾…åŠäº‹é¡¹

- å¦‚æœä½ ä»¥ **Admin**ï¼ˆæ‹¥æœ‰å…¨éƒ¨æƒé™ï¼š`create:todos`ã€`read:todos`ã€`delete:todos`ï¼‰èº«ä»½ç™»å½•ï¼š
  - å¯ä»¥åˆ›å»ºæ–°å¾…åŠäº‹é¡¹
  - å¯ä»¥ç”¨ `get-todos` å·¥å…·æŸ¥çœ‹ç³»ç»Ÿä¸­æ‰€æœ‰å¾…åŠäº‹é¡¹
  - å¯ä»¥ç”¨ `delete-todo` å·¥å…·åˆ é™¤ä»»æ„å¾…åŠäº‹é¡¹ï¼Œæ— è®ºå½’å±è°

ä½ å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼æµ‹è¯•ä¸åŒæƒé™çº§åˆ«ï¼š

1. é€€å‡ºå½“å‰ä¼šè¯ï¼ˆç‚¹å‡» MCP inspector çš„â€œDisconnectâ€æŒ‰é’®ï¼‰
2. ç”¨æ‹¥æœ‰ä¸åŒè§’è‰²/æƒé™çš„å…¶ä»–ç”¨æˆ·è´¦å·ç™»å½•
3. å†æ¬¡å°è¯•ç›¸åŒå·¥å…·ï¼Œè§‚å¯Ÿç”¨æˆ·æƒé™å˜åŒ–å¸¦æ¥çš„è¡Œä¸ºå·®å¼‚

è¿™å±•ç¤ºäº†åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶ (RBAC) åœ¨å®é™…ä¸­çš„å·¥ä½œæ–¹å¼ï¼Œä¸åŒç”¨æˆ·å¯¹ç³»ç»ŸåŠŸèƒ½æœ‰ä¸åŒè®¿é—®çº§åˆ«ã€‚

![MCP inspector å¾…åŠäº‹é¡¹ç®¡ç†å·¥å…·ç»“æœ](/docs-assets/images/tutorials/todo-manager/result.png)

<Tabs groupId="sdk">
<TabItem value="python" label="Python">

:::info
å®Œæ•´ MCP æœåŠ¡å™¨ï¼ˆOIDC ç‰ˆæœ¬ï¼‰ä»£ç è¯·å‚è€ƒ [MCP Auth Python SDK ä»“åº“](https://github.com/mcp-auth/python/blob/master/samples/server/todo-manager/server.py)ã€‚
:::

</TabItem>
<TabItem value="node" label="Node.js">

:::info
å®Œæ•´ MCP æœåŠ¡å™¨ï¼ˆOIDC ç‰ˆæœ¬ï¼‰ä»£ç è¯·å‚è€ƒ [MCP Auth Node.js SDK ä»“åº“](https://github.com/mcp-auth/js/blob/master/packages/sample-servers/src)ã€‚
:::

</TabItem>
</Tabs>

## ç»“è¯­ \{#closing-notes}

ğŸŠ æ­å–œä½ ï¼ä½ å·²æˆåŠŸå®Œæˆæœ¬æ•™ç¨‹ã€‚è®©æˆ‘ä»¬å›é¡¾ä¸€ä¸‹æ‰€åšçš„å†…å®¹ï¼š

- æ­å»ºäº†ä¸€ä¸ªå¸¦æœ‰å¾…åŠäº‹é¡¹ç®¡ç†å·¥å…·ï¼ˆ`create-todo`ã€`get-todos`ã€`delete-todo`ï¼‰çš„åŸºç¡€ MCP æœåŠ¡å™¨
- å®ç°äº†åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶ (RBAC)ï¼Œä¸ºç”¨æˆ·å’Œç®¡ç†å‘˜è®¾ç½®äº†ä¸åŒæƒé™çº§åˆ«
- ä½¿ç”¨ MCP Auth å°† MCP æœåŠ¡å™¨é›†æˆåˆ°æˆæƒ (Authorization) æœåŠ¡å™¨
- é…ç½® MCP Inspector è®¤è¯ (Authentication) ç”¨æˆ·ï¼Œå¹¶ç”¨å¸¦æƒé™ (Scopes) çš„è®¿é—®ä»¤ç‰Œ (Access token) è°ƒç”¨å·¥å…·

æ¬¢è¿æŸ¥é˜…å…¶ä»–æ•™ç¨‹å’Œæ–‡æ¡£ï¼Œå……åˆ†åˆ©ç”¨ MCP Auth çš„å¼ºå¤§åŠŸèƒ½ã€‚
