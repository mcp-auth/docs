---
sidebar_position: 1
sidebar_label: 'Tutorial: Quem sou eu?'
---

import TabItem from '@theme/TabItem';
import Tabs from '@theme/Tabs';

import SetupOauth from './_setup-oauth.mdx';
import SetupOidc from './_setup-oidc.mdx';

# Tutorial: Quem sou eu? (Who am I?)

Este tutorial ir√° gui√°-lo pelo processo de configura√ß√£o do MCP Auth para autenticar usu√°rios e recuperar suas informa√ß√µes de identidade do servidor de autoriza√ß√£o.

Ap√≥s concluir este tutorial, voc√™ ter√°:

- ‚úÖ Uma compreens√£o b√°sica de como usar o MCP Auth para autenticar usu√°rios.
- ‚úÖ Um servidor MCP que oferece uma ferramenta para recuperar informa√ß√µes de identidade do usu√°rio.

## Vis√£o geral (Overview) \{#overview}

O tutorial envolver√° os seguintes componentes:

- **Servidor MCP**: Um servidor MCP simples que utiliza os SDKs oficiais do MCP para lidar com requisi√ß√µes.
- **MCP inspector**: Uma ferramenta visual de testes para servidores MCP. Tamb√©m atua como um cliente OAuth / OIDC para iniciar o fluxo de autoriza√ß√£o e recuperar tokens de acesso.
- **Servidor de autoriza√ß√£o (Authorization server)**: Um provedor OAuth 2.1 ou OpenID Connect que gerencia identidades de usu√°rios e emite tokens de acesso.

Aqui est√° um diagrama de alto n√≠vel da intera√ß√£o entre esses componentes:

```mermaid
sequenceDiagram
    participant Client as MCP Inspector
    participant Server as Servidor MCP
    participant Auth as Servidor de autoriza√ß√£o

    Client->>Server: Solicitar ferramenta `whoami`
    Server->>Client: Retornar 401 N√£o autorizado
    Client->>Auth: Iniciar fluxo de autoriza√ß√£o
    Auth->>Auth: Completar fluxo de autoriza√ß√£o
    Auth->>Client: Redirecionar de volta com c√≥digo de autoriza√ß√£o
    Client->>Auth: Trocar c√≥digo por token de acesso
    Auth->>Client: Retornar token de acesso
    Client->>Server: Solicitar `whoami` com token de acesso
    Server->>Auth: Buscar identidade do usu√°rio com token de acesso
    Auth->>Server: Retornar identidade do usu√°rio
    Server->>Client: Retornar identidade do usu√°rio
```

## Entenda seu servidor de autoriza√ß√£o (Understand your authorization server) \{#understand-your-authorization-server}

### Recuperando informa√ß√µes de identidade do usu√°rio (Retrieving user identity information) \{#retrieving-user-identity-information}

Para concluir este tutorial, seu servidor de autoriza√ß√£o deve oferecer uma API para recuperar informa√ß√µes de identidade do usu√°rio:

<Tabs groupId="provider">
<TabItem value="logto" label="Logto">

[Logto](https://logto.io) √© um provedor OpenID Connect que suporta o [endpoint userinfo](https://openid.net/specs/openid-connect-core-1_0.html#UserInfo) padr√£o para recuperar informa√ß√µes de identidade do usu√°rio.

Para obter um token de acesso que possa ser usado para acessar o endpoint userinfo, pelo menos dois escopos s√£o necess√°rios: `openid` e `profile`. Voc√™ pode continuar lendo, pois abordaremos a configura√ß√£o de escopos mais adiante.

</TabItem>
<TabItem value="keycloak" label="Keycloak">

[Keycloak](https://www.keycloak.org) √© uma solu√ß√£o open-source de gerenciamento de identidade e acesso que suporta m√∫ltiplos protocolos, incluindo OpenID Connect (OIDC). Como provedor OIDC, ele implementa o [endpoint userinfo](https://openid.net/specs/openid-connect-core-1_0.html#UserInfo) padr√£o para recuperar informa√ß√µes de identidade do usu√°rio.

Para obter um token de acesso que possa ser usado para acessar o endpoint userinfo, pelo menos dois escopos s√£o necess√°rios: `openid` e `profile`. Voc√™ pode continuar lendo, pois abordaremos a configura√ß√£o de escopos mais adiante.

</TabItem>

<TabItem value="asgardeo" label="Asgardeo">

[Asgardeo](https://wso2.com/asgardeo) √© uma plataforma IDaaS nativa em nuvem que suporta OAuth 2.0 e OpenID Connect (OIDC), fornecendo gerenciamento robusto de identidade e acesso para aplica√ß√µes modernas.

As informa√ß√µes do usu√°rio s√£o codificadas dentro do Token de ID retornado junto com o token de acesso. Mas, como provedor OIDC, o Asgardeo exp√µe um [endpoint UserInfo](https://wso2.com/asgardeo/docs/guides/authentication/oidc/request-user-info/) que permite que aplica√ß√µes recuperem reivindica√ß√µes sobre o usu√°rio autenticado no payload.

Voc√™ tamb√©m pode descobrir esse endpoint dinamicamente via o [endpoint de descoberta OIDC](https://wso2.com/asgardeo/docs/guides/authentication/oidc/discover-oidc-configs) ou navegando at√© a aba 'Info' do aplicativo no Console Asgardeo.

Para obter um token de acesso que possa ser usado para acessar o endpoint userinfo, pelo menos dois escopos s√£o necess√°rios: `openid` e `profile`.
</TabItem>
<TabItem value="oidc" label="OIDC">

A maioria dos provedores OpenID Connect suporta o [endpoint userinfo](https://openid.net/specs/openid-connect-core-1_0.html#UserInfo) para recuperar informa√ß√µes de identidade do usu√°rio.

Verifique a documenta√ß√£o do seu provedor para ver se ele suporta esse endpoint. Se seu provedor suporta [OpenID Connect Discovery](https://openid.net/specs/openid-connect-discovery-1_0.html), voc√™ tamb√©m pode verificar se o `userinfo_endpoint` est√° inclu√≠do no documento de descoberta (resposta do endpoint `.well-known/openid-configuration`).

Para obter um token de acesso que possa ser usado para acessar o endpoint userinfo, pelo menos dois escopos s√£o necess√°rios: `openid` e `profile`. Verifique a documenta√ß√£o do seu provedor para ver o mapeamento de escopos para reivindica√ß√µes de identidade do usu√°rio.

</TabItem>
<TabItem value="oauth" label="OAuth 2">

Embora o OAuth 2.0 n√£o defina uma maneira padr√£o de recuperar informa√ß√µes de identidade do usu√°rio, muitos provedores implementam seus pr√≥prios endpoints para isso. Verifique a documenta√ß√£o do seu provedor para saber como recuperar informa√ß√µes de identidade do usu√°rio usando um token de acesso e quais par√¢metros s√£o necess√°rios para obter esse token ao invocar o fluxo de autoriza√ß√£o.

</TabItem>
</Tabs>

### Registro din√¢mico de cliente (Dynamic Client Registration) \{#dynamic-client-registration}

O Registro Din√¢mico de Cliente n√£o √© necess√°rio para este tutorial, mas pode ser √∫til se voc√™ quiser automatizar o processo de registro do cliente MCP com seu servidor de autoriza√ß√£o. Consulte [O Registro Din√¢mico de Cliente √© necess√°rio?](../../provider-list.mdx#is-dcr-required) para mais detalhes.

## Configure o servidor MCP (Set up the MCP server) \{#set-up-the-mcp-server}

Usaremos os [SDKs oficiais do MCP](https://github.com/modelcontextprotocol) para criar um servidor MCP com uma ferramenta `whoami` que recupera informa√ß√µes de identidade do usu√°rio do servidor de autoriza√ß√£o.

### Crie um novo projeto (Create a new project) \{#create-a-new-project}

<Tabs groupId="sdk">
<TabItem value="python" label="Python">

```bash
mkdir mcp-server
cd mcp-server
uv init # Ou use `pipenv` ou `poetry` para criar um novo ambiente virtual
```

</TabItem>
<TabItem value="node" label="Node.js">

Configure um novo projeto Node.js:

```bash
mkdir mcp-server
cd mcp-server
npm init -y # Ou use `pnpm init`
npm pkg set type="module"
npm pkg set main="whoami.js"
npm pkg set scripts.start="node whoami.js"
```

</TabItem>
</Tabs>

### Instale o MCP SDK e depend√™ncias (Install the MCP SDK and dependencies) \{#install-the-mcp-sdk-and-dependencies}

<Tabs groupId="sdk">
<TabItem value="python" label="Python">

```bash
pip install "mcp[cli]" starlette uvicorn
```

Ou qualquer outro gerenciador de pacotes de sua prefer√™ncia, como `uv` ou `poetry`.

</TabItem>
<TabItem value="node" label="Node.js">

```bash
npm install @modelcontextprotocol/sdk express
```

Ou qualquer outro gerenciador de pacotes de sua prefer√™ncia, como `pnpm` ou `yarn`.

</TabItem>
</Tabs>

### Crie o servidor MCP (Create the MCP server) \{#create-the-mcp-server}

Primeiro, vamos criar um servidor MCP que implementa uma ferramenta `whoami`.

<Tabs groupId="sdk">
<TabItem value="python" label="Python">

Crie um arquivo chamado `whoami.py` e adicione o seguinte c√≥digo:

```python
from mcp.server.fastmcp import FastMCP
from starlette.applications import Starlette
from starlette.routing import Mount
from typing import Any

mcp = FastMCP("WhoAmI")

@mcp.tool()
def whoami() -> dict[str, Any]:
    """Uma ferramenta que retorna as informa√ß√µes do usu√°rio atual."""
    return {"error": "Not authenticated"}

app = Starlette(
    routes=[Mount('/', app=mcp.sse_app())]
)
```

Execute o servidor com:

```bash
uvicorn whoami:app --host 0.0.0.0 --port 3001
```

</TabItem>
<TabItem value="node" label="Node.js">

:::note
Como a implementa√ß√£o atual do MCP inspector n√£o lida com fluxos de autoriza√ß√£o, usaremos a abordagem SSE para configurar o servidor MCP. Atualizaremos o c√≥digo aqui assim que o MCP inspector suportar fluxos de autoriza√ß√£o.
:::

Voc√™ tamb√©m pode usar `pnpm` ou `yarn` se preferir.

Crie um arquivo chamado `whoami.js` e adicione o seguinte c√≥digo:

```js
import { McpServer } from '@modelcontextprotocol/sdk/server/mcp.js';
import { SSEServerTransport } from '@modelcontextprotocol/sdk/server/sse.js';
import express from 'express';

// Crie um servidor MCP
const server = new McpServer({
  name: 'WhoAmI',
  version: '0.0.0',
});

// Adicione uma ferramenta ao servidor que retorna as informa√ß√µes do usu√°rio atual
server.tool('whoami', async () => {
  return {
    content: [{ type: 'text', text: JSON.stringify({ error: 'Not authenticated' }) }],
  };
});

// Abaixo est√° o c√≥digo boilerplate da documenta√ß√£o do MCP SDK
const PORT = 3001;
const app = express();

const transports = {};

app.get('/sse', async (_req, res) => {
  const transport = new SSEServerTransport('/messages', res);
  transports[transport.sessionId] = transport;

  res.on('close', () => {
    delete transports[transport.sessionId];
  });

  await server.connect(transport);
});

app.post('/messages', async (req, res) => {
  const sessionId = String(req.query.sessionId);
  const transport = transports[sessionId];
  if (transport) {
    await transport.handlePostMessage(req, res, req.body);
  } else {
    res.status(400).send('No transport found for sessionId');
  }
});

app.listen(PORT);
```

Execute o servidor com:

```bash
npm start
```

</TabItem>
</Tabs>

## Inspecione o servidor MCP (Inspect the MCP server) \{#inspect-the-mcp-server}

### Clone e execute o MCP inspector (Clone and run MCP inspector) \{#clone-and-run-mcp-inspector}

Agora que temos o servidor MCP em execu√ß√£o, podemos usar o MCP inspector para ver se a ferramenta `whoami` est√° dispon√≠vel.

Devido √† limita√ß√£o da implementa√ß√£o atual, fizemos um fork do [MCP inspector](https://github.com/mcp-auth/inspector) para torn√°-lo mais flex√≠vel e escal√°vel para autentica√ß√£o e autoriza√ß√£o. Tamb√©m enviamos um pull request para o reposit√≥rio original para incluir nossas altera√ß√µes.

Para executar o MCP inspector, voc√™ pode usar o seguinte comando (Node.js √© necess√°rio):

```bash
git clone https://github.com/mcp-auth/inspector.git
cd inspector
npm install
npm run dev
```

Depois, abra seu navegador e navegue at√© `http://localhost:6274/` (ou outro URL exibido no terminal) para acessar o MCP inspector.

### Conecte o MCP inspector ao servidor MCP (Connect MCP inspector to the MCP server) \{#connect-mcp-inspector-to-the-mcp-server}

Antes de prosseguir, verifique a seguinte configura√ß√£o no MCP inspector:

- **Tipo de transporte (Transport Type)**: Defina como `SSE`.
- **URL**: Defina para a URL do seu servidor MCP. No nosso caso, deve ser `http://localhost:3001/sse`.

Agora voc√™ pode clicar no bot√£o "Connect" para ver se o MCP inspector consegue se conectar ao servidor MCP. Se tudo estiver certo, voc√™ ver√° o status "Connected" no MCP inspector.

### Checkpoint: Execute a ferramenta `whoami` (Checkpoint: Run the `whoami` tool) \{#checkpoint-run-the-whoami-tool}

1. No menu superior do MCP inspector, clique na aba "Tools".
2. Clique no bot√£o "List Tools".
3. Voc√™ deve ver a ferramenta `whoami` listada na p√°gina. Clique nela para abrir os detalhes da ferramenta.
4. Voc√™ deve ver o bot√£o "Run Tool" no lado direito. Clique nele para executar a ferramenta.
5. Voc√™ deve ver o resultado da ferramenta com a resposta JSON `{"error": "Not authenticated"}`.

![Primeira execu√ß√£o do MCP inspector](/docs-assets/images/tutorials/whoami/inspector-first-run.png)

## Integre com seu servidor de autoriza√ß√£o (Integrate with your authorization server) \{#integrate-with-your-authorization-server}

Para concluir esta se√ß√£o, h√° v√°rias considera√ß√µes a serem levadas em conta:

<details>
<summary>**A URL do emissor do seu servidor de autoriza√ß√£o (The issuer URL of your authorization server)**</summary>

Normalmente, √© a URL base do seu servidor de autoriza√ß√£o, como `https://auth.example.com`. Alguns provedores podem ter um caminho como `https://example.logto.app/oidc`, ent√£o certifique-se de verificar a documenta√ß√£o do seu provedor.

</details>

<details>
<summary>**Como recuperar os metadados do servidor de autoriza√ß√£o (How to retrieve the authorization server metadata)**</summary>

- Se seu servidor de autoriza√ß√£o estiver em conformidade com o [OAuth 2.0 Authorization Server Metadata](https://datatracker.ietf.org/doc/html/rfc8414) ou [OpenID Connect Discovery](https://openid.net/specs/openid-connect-discovery-1_0.html), voc√™ pode usar as utilidades integradas do MCP Auth para buscar os metadados automaticamente.
- Se seu servidor de autoriza√ß√£o n√£o estiver em conformidade com esses padr√µes, voc√™ precisar√° especificar manualmente a URL dos metadados ou endpoints na configura√ß√£o do servidor MCP. Verifique a documenta√ß√£o do seu provedor para os endpoints espec√≠ficos.

</details>

<details>
<summary>**Como registrar o MCP inspector como cliente em seu servidor de autoriza√ß√£o (How to register the MCP inspector as a client in your authorization server)**</summary>

- Se seu servidor de autoriza√ß√£o suporta [Dynamic Client Registration](https://datatracker.ietf.org/doc/html/rfc7591), voc√™ pode pular esta etapa, pois o MCP inspector ir√° se registrar automaticamente como cliente.
- Se seu servidor de autoriza√ß√£o n√£o suporta Dynamic Client Registration, voc√™ precisar√° registrar manualmente o MCP inspector como cliente em seu servidor de autoriza√ß√£o.

</details>

<details>
<summary>**Como recuperar informa√ß√µes de identidade do usu√°rio e como configurar os par√¢metros da solicita√ß√£o de autoriza√ß√£o (How to retrieve user identity information and how to configure the authorization request parameters)**</summary>

- Para provedores OpenID Connect: normalmente voc√™ precisa solicitar pelo menos os escopos `openid` e `profile` ao iniciar o fluxo de autoriza√ß√£o. Isso garantir√° que o token de acesso retornado pelo servidor de autoriza√ß√£o contenha os escopos necess√°rios para acessar o [endpoint userinfo](https://openid.net/specs/openid-connect-core-1_0.html#UserInfo) e recuperar informa√ß√µes de identidade do usu√°rio.

  Nota: Alguns provedores podem n√£o suportar o endpoint userinfo.

- Para provedores OAuth 2.0 / OAuth 2.1: verifique a documenta√ß√£o do seu provedor para saber como recuperar informa√ß√µes de identidade do usu√°rio usando um token de acesso e quais par√¢metros s√£o necess√°rios para obter esse token ao invocar o fluxo de autoriza√ß√£o.

</details>

Embora cada provedor possa ter seus pr√≥prios requisitos espec√≠ficos, as etapas a seguir ir√£o gui√°-lo pelo processo de integra√ß√£o do MCP inspector e do servidor MCP com configura√ß√µes espec√≠ficas do provedor.

### Registre o MCP inspector como cliente (Register MCP inspector as a client) \{#register-mcp-inspector-as-a-client}

<Tabs groupId="provider">
<TabItem value="logto" label="Logto">

A integra√ß√£o com o [Logto](https://logto.io) √© simples, pois √© um provedor OpenID Connect que suporta o [endpoint userinfo](https://openid.net/specs/openid-connect-core-1_0.html#UserInfo) padr√£o para recuperar informa√ß√µes de identidade do usu√°rio.

Como o Logto ainda n√£o suporta Dynamic Client Registration, voc√™ precisar√° registrar manualmente o MCP inspector como cliente em seu tenant Logto:

1. Abra seu MCP inspector, clique no bot√£o "OAuth Configuration". Copie o valor de **Redirect URL (auto-populated)**, que deve ser algo como `http://localhost:6274/oauth/callback`.
2. Acesse o [Logto Console](https://cloud.logto.io) (ou seu Logto Console auto-hospedado).
3. Navegue at√© a aba "Applications", clique em "Create application". No final da p√°gina, clique em "Create app without framework".
4. Preencha os detalhes do aplicativo e clique em "Create application":
   - **Selecione um tipo de aplicativo**: Escolha "Single-page application".
   - **Nome do aplicativo**: Insira um nome para seu aplicativo, por exemplo, "MCP Inspector".
5. Na se√ß√£o "Settings / Redirect URIs", cole o valor de **Redirect URL (auto-populated)** que voc√™ copiou do MCP inspector. Depois clique em "Save changes" na barra inferior.
6. No cart√£o superior, voc√™ ver√° o valor "App ID". Copie-o.
7. Volte ao MCP inspector e cole o valor "App ID" na se√ß√£o "OAuth Configuration" em "Client ID".
8. Insira o valor `{"scope": "openid profile email"}` no campo "Auth Params". Isso garantir√° que o token de acesso retornado pelo Logto contenha os escopos necess√°rios para acessar o endpoint userinfo.

</TabItem>
<TabItem value="keycloak" label="Keycloak">

[Keycloak](https://www.keycloak.org) √© uma solu√ß√£o open-source de gerenciamento de identidade e acesso que suporta o protocolo OpenID Connect.

Embora o Keycloak suporte registro din√¢mico de clientes, seu endpoint de registro de clientes n√£o suporta CORS, impedindo que a maioria dos clientes MCP se registrem diretamente. Portanto, precisaremos registrar nosso cliente manualmente.

:::note
Embora o Keycloak possa ser instalado de [v√°rias formas](https://www.keycloak.org/guides#getting-started) (bare metal, kubernetes, etc.), para este tutorial, usaremos Docker para uma configura√ß√£o r√°pida e simples.
:::

Vamos configurar uma inst√¢ncia Keycloak e ajust√°-la para nossas necessidades:

1. Primeiro, execute uma inst√¢ncia Keycloak usando Docker conforme a [documenta√ß√£o oficial](https://www.keycloak.org/getting-started/getting-started-docker):

```bash
docker run -p 8080:8080 -e KC_BOOTSTRAP_ADMIN_USERNAME=admin -e KC_BOOTSTRAP_ADMIN_PASSWORD=admin quay.io/keycloak/keycloak:26.2.4 start-dev
```

2. Acesse o Keycloak Admin Console (http://localhost:8080/admin) e fa√ßa login com estas credenciais:

   - Usu√°rio: `admin`
   - Senha: `admin`

3. Crie um novo Realm:

   - Clique em "Create Realm" no canto superior esquerdo
   - Digite `mcp-realm` no campo "Realm name"
   - Clique em "Create"

4. Crie um usu√°rio de teste:

   - Clique em "Users" no menu √† esquerda
   - Clique em "Create new user"
   - Preencha os detalhes do usu√°rio:
     - Username: `testuser`
     - First name e Last name podem ser quaisquer valores
   - Clique em "Create"
   - Na aba "Credentials", defina uma senha e desmarque "Temporary"

5. Registre o MCP Inspector como cliente:

   - Abra seu MCP inspector, clique no bot√£o "OAuth Configuration". Copie o valor de **Redirect URL (auto-populated)**, que deve ser algo como `http://localhost:6274/oauth/callback`.
   - No Keycloak Admin Console, clique em "Clients" no menu √† esquerda
   - Clique em "Create client"
   - Preencha os detalhes do cliente:
     - Client type: Selecione "OpenID Connect"
     - Client ID: Digite `mcp-inspector`
     - Clique em "Next"
   - Na p√°gina "Capability config":
     - Certifique-se de que "Standard flow" est√° habilitado
     - Clique em "Next"
   - Na p√°gina "Login settings":
     - Cole a URL de callback do MCP Inspector em "Valid redirect URIs"
     - Digite `http://localhost:6274` em "Web origins"
     - Clique em "Save"
   - Copie o "Client ID" (que √© `mcp-inspector`)

6. No MCP Inspector:
   - Cole o Client ID copiado no campo "Client ID" na se√ß√£o "OAuth Configuration"
   - Insira o seguinte valor no campo "Auth Params" para solicitar os escopos necess√°rios:

```json
{ "scope": "openid profile email" }
```

 </TabItem>
<TabItem value="asgardeo" label="Asgardeo">

Embora o Asgardeo suporte registro din√¢mico de clientes via API padr√£o, o endpoint √© protegido e requer um token de acesso com as permiss√µes necess√°rias. Neste tutorial, registraremos o cliente manualmente pelo Console Asgardeo.

:::note
Se voc√™ ainda n√£o tem uma conta Asgardeo, pode [criar uma gratuitamente](https://asgardeo.io).
:::

Siga estes passos para configurar o Asgardeo para o MCP Inspector:

1. Fa√ßa login no [Console Asgardeo](https://console.asgardeo.io) e selecione sua organiza√ß√£o.

2. Crie um novo aplicativo:
    - V√° em **Applications** ‚Üí **New Application**
    - Escolha **Single-Page Application**
    - Insira um nome como `MCP Inspector`
    - No campo **Authorized Redirect URLs**, cole a **Redirect URL** copiada do MCP Inspector (ex.: `http://localhost:6274/oauth/callback`)
    - Clique em **Create**

3. Configure as configura√ß√µes de protocolo:
    - Na aba **Protocol**:
    - Copie o **Client ID** gerado automaticamente.
    - Certifique-se de mudar para `JWT` em `Token Type` na se√ß√£o **Access Token**
    - Clique em **Update**

4. No MCP Inspector:
    - Abra a se√ß√£o **OAuth Configuration**
    - Cole o **Client ID** copiado
    - Insira o seguinte no campo **Auth Params** para solicitar os escopos necess√°rios:

```json
{ "scope": "openid profile email" }
```
 </TabItem>
<TabItem value="oidc" label="OIDC">

:::note
Este √© um guia gen√©rico de integra√ß√£o com provedores OpenID Connect. Verifique a documenta√ß√£o do seu provedor para detalhes espec√≠ficos.
:::

Se seu provedor OpenID Connect suporta Dynamic Client Registration, voc√™ pode ir direto ao passo 8 abaixo para configurar o MCP inspector; caso contr√°rio, ser√° necess√°rio registrar manualmente o MCP inspector como cliente em seu provedor OpenID Connect:

1. Abra seu MCP inspector, clique no bot√£o "OAuth Configuration". Copie o valor de **Redirect URL (auto-populated)**, que deve ser algo como `http://localhost:6274/oauth/callback`.
2. Acesse o console do seu provedor OpenID Connect.
3. Navegue at√© a se√ß√£o "Applications" ou "Clients" e crie um novo aplicativo ou cliente.
4. Se seu provedor exigir um tipo de cliente, selecione "Single-page application" ou "Public client".
5. Ap√≥s criar o aplicativo, ser√° necess√°rio configurar a URI de redirecionamento. Cole o valor de **Redirect URL (auto-populated)** que voc√™ copiou do MCP inspector.
6. Encontre o "Client ID" ou "Application ID" do aplicativo rec√©m-criado e copie-o.
7. Volte ao MCP inspector e cole o valor "Client ID" na se√ß√£o "OAuth Configuration" em "Client ID".
8. Para provedores OpenID Connect padr√£o, voc√™ pode inserir o seguinte valor no campo "Auth Params" para solicitar os escopos necess√°rios para acessar o endpoint userinfo:

```json
{ "scope": "openid profile email" }
```

</TabItem>
<TabItem value="oauth" label="OAuth 2">

:::note
Este √© um guia gen√©rico de integra√ß√£o com provedores OAuth 2.0 / OAuth 2.1. Verifique a documenta√ß√£o do seu provedor para detalhes espec√≠ficos.
:::

Se seu provedor OAuth 2.0 / OAuth 2.1 suporta Dynamic Client Registration, voc√™ pode ir direto ao passo 8 abaixo para configurar o MCP inspector; caso contr√°rio, ser√° necess√°rio registrar manualmente o MCP inspector como cliente em seu provedor OAuth 2.0 / OAuth 2.1:

1. Abra seu MCP inspector, clique no bot√£o "OAuth Configuration". Copie o valor de **Redirect URL (auto-populated)**, que deve ser algo como `http://localhost:6274/oauth/callback`.
2. Acesse o console do seu provedor OAuth 2.0 / OAuth 2.1.
3. Navegue at√© a se√ß√£o "Applications" ou "Clients" e crie um novo aplicativo ou cliente.
4. Se seu provedor exigir um tipo de cliente, selecione "Single-page application" ou "Public client".
5. Ap√≥s criar o aplicativo, ser√° necess√°rio configurar a URI de redirecionamento. Cole o valor de **Redirect URL (auto-populated)** que voc√™ copiou do MCP inspector.
6. Encontre o "Client ID" ou "Application ID" do aplicativo rec√©m-criado e copie-o.
7. Volte ao MCP inspector e cole o valor "Client ID" na se√ß√£o "OAuth Configuration" em "Client ID".
8. Leia a documenta√ß√£o do seu provedor para saber como recuperar tokens de acesso para informa√ß√µes de identidade do usu√°rio. Pode ser necess√°rio especificar os escopos ou par√¢metros necess√°rios para obter o token de acesso. Por exemplo, se seu provedor exigir o escopo `profile` para acessar informa√ß√µes de identidade do usu√°rio, voc√™ pode inserir o seguinte valor no campo "Auth Params":

```json
{ "scope": "profile" }
```

</TabItem>
</Tabs>

### Configure o MCP auth (Set up MCP auth) \{#set-up-mcp-auth}

No seu projeto do servidor MCP, voc√™ precisa instalar o SDK do MCP Auth e configur√°-lo para usar os metadados do seu servidor de autoriza√ß√£o.

<Tabs groupId="sdk">
<TabItem value="python" label="Python">

Primeiro, instale o pacote `mcpauth`:

```bash
pip install mcpauth
```

Ou qualquer outro gerenciador de pacotes de sua prefer√™ncia, como `uv` ou `poetry`.

</TabItem>
<TabItem value="node" label="Node.js">

Primeiro, instale o pacote `mcp-auth`:

```bash
npm install mcp-auth
```

</TabItem>
</Tabs>

O MCP Auth requer os metadados do servidor de autoriza√ß√£o para poder inicializar. Dependendo do seu provedor:

<Tabs groupId="provider">

<TabItem value="logto" label="Logto">

A URL do emissor pode ser encontrada na p√°gina de detalhes do seu aplicativo no Logto Console, na se√ß√£o "Endpoints & Credentials / Issuer endpoint". Deve ser algo como `https://my-project.logto.app/oidc`.

<SetupOidc />

</TabItem>

<TabItem value="keycloak" label="Keycloak">

A URL do emissor pode ser encontrada no Keycloak Admin Console. No seu 'mcp-realm', navegue at√© a se√ß√£o "Realm settings / Endpoints" e clique no link "OpenID Endpoint Configuration". O campo `issuer` no documento JSON conter√° sua URL de emissor, que deve ser algo como `http://localhost:8080/realms/mcp-realm`.

<SetupOidc />

</TabItem>

<TabItem value="asgardeo" label="Asgardeo">

    Voc√™ pode encontrar a URL do emissor no Console Asgardeo. Navegue at√© o aplicativo criado e abra a aba **Info**. O campo **Issuer** ser√° exibido l√° e deve ser algo como:
    `https://api.asgardeo.io/t/<your-organization-name>/oauth2/token`
    
    <SetupOidc />

</TabItem>

<TabItem value="oidc" label="OIDC">

O c√≥digo a seguir tamb√©m assume que o servidor de autoriza√ß√£o suporta o [endpoint userinfo](https://openid.net/specs/openid-connect-core-1_0.html#UserInfo) para recuperar informa√ß√µes de identidade do usu√°rio. Se seu provedor n√£o suportar esse endpoint, voc√™ precisar√° verificar a documenta√ß√£o do seu provedor para o endpoint espec√≠fico e substituir a vari√°vel do endpoint userinfo pela URL correta.

<SetupOidc showAlternative />

</TabItem>
<TabItem value="oauth" label="OAuth 2">

Como mencionamos anteriormente, o OAuth 2.0 n√£o define uma maneira padr√£o de recuperar informa√ß√µes de identidade do usu√°rio. O c√≥digo a seguir assume que seu provedor possui um endpoint espec√≠fico para recuperar informa√ß√µes de identidade do usu√°rio usando um token de acesso. Voc√™ precisar√° verificar a documenta√ß√£o do seu provedor para o endpoint espec√≠fico e substituir a vari√°vel do endpoint userinfo pela URL correta.

<SetupOauth />

</TabItem>
</Tabs>

### Atualize o servidor MCP (Update MCP server) \{#update-mcp-server}

Estamos quase l√°! √â hora de atualizar o servidor MCP para aplicar a rota e o middleware do MCP Auth, e ent√£o fazer a ferramenta `whoami` retornar as informa√ß√µes reais de identidade do usu√°rio.

<Tabs groupId="sdk">
<TabItem value="python" label="Python">

```python
@mcp.tool()
def whoami() -> dict[str, Any]:
    """Uma ferramenta que retorna as informa√ß√µes do usu√°rio atual."""
    return (
        mcp_auth.auth_info.claims
        if mcp_auth.auth_info # Isso ser√° preenchido pelo middleware Bearer auth
        else {"error": "Not authenticated"}
    )

# ...

bearer_auth = Middleware(mcp_auth.bearer_auth_middleware(verify_access_token))
app = Starlette(
    routes=[
        # Adicione a rota de metadados (`/.well-known/oauth-authorization-server`)
        mcp_auth.metadata_route(),
        # Proteja o servidor MCP com o middleware Bearer auth
        Mount('/', app=mcp.sse_app(), middleware=[bearer_auth]),
    ],
)
```

</TabItem>
<TabItem value="node" label="Node.js">

```js
server.tool('whoami', ({ authInfo }) => {
  return {
    content: [
      { type: 'text', text: JSON.stringify(authInfo?.claims ?? { error: 'Not authenticated' }) },
    ],
  };
});

// ...

app.use(mcpAuth.delegatedRouter());
app.use(mcpAuth.bearerAuth(verifyToken));
```

</TabItem>
</Tabs>

## Checkpoint: Execute a ferramenta `whoami` com autentica√ß√£o (Checkpoint: Run the `whoami` tool with authentication) \{#checkpoint-run-the-whoami-tool-with-authentication}

Reinicie seu servidor MCP e abra o MCP inspector no navegador. Ao clicar no bot√£o "Connect", voc√™ deve ser redirecionado para a p√°gina de login do seu servidor de autoriza√ß√£o.

Depois de fazer login e retornar ao MCP inspector, repita as a√ß√µes do checkpoint anterior para executar a ferramenta `whoami`. Desta vez, voc√™ dever√° ver as informa√ß√µes de identidade do usu√°rio retornadas pelo servidor de autoriza√ß√£o.

![Resultado da ferramenta whoami no MCP inspector](/docs-assets/images/tutorials/whoami/result.png)

<Tabs groupId="sdk">
<TabItem value="python" label="Python">

:::info
Confira o [reposit√≥rio do MCP Auth Python SDK](https://github.com/mcp-auth/python/blob/master/samples/server/whoami.py) para o c√≥digo completo do servidor MCP (vers√£o OIDC).
:::

</TabItem>
<TabItem value="node" label="Node.js">

:::info
Confira o [reposit√≥rio do MCP Auth Node.js SDK](https://github.com/mcp-auth/js/blob/master/packages/sample-servers/src) para o c√≥digo completo do servidor MCP (vers√£o OIDC). Este diret√≥rio cont√©m vers√µes em TypeScript e JavaScript do c√≥digo.
:::

</TabItem>
</Tabs>

## Notas finais (Closing notes) \{#closing-notes}

üéä Parab√©ns! Voc√™ concluiu com sucesso o tutorial. Vamos recapitular o que fizemos:

- Configura√ß√£o de um servidor MCP b√°sico com a ferramenta `whoami`
- Integra√ß√£o do servidor MCP com um servidor de autoriza√ß√£o usando MCP Auth
- Configura√ß√£o do MCP Inspector para autenticar usu√°rios e recuperar suas informa√ß√µes de identidade

Voc√™ tamb√©m pode explorar alguns t√≥picos avan√ßados, incluindo:

- Uso de [JWT (JSON Web Token)](https://auth.wiki/jwt) para autentica√ß√£o e autoriza√ß√£o
- Aproveitamento de [indicadores de recurso (RFC 8707)](https://auth-wiki.logto.io/resource-indicator) para especificar os recursos acessados
- Implementa√ß√£o de mecanismos personalizados de controle de acesso, como [controle de acesso baseado em papel (RBAC)](https://auth.wiki/rbac) ou [controle de acesso baseado em atributos (ABAC)](https://auth.wiki/abac)

N√£o deixe de conferir outros tutoriais e a documenta√ß√£o para aproveitar ao m√°ximo o MCP Auth.