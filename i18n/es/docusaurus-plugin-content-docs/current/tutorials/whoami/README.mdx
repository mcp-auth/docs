---
sidebar_position: 1
sidebar_label: 'Tutorial: ¬øQui√©n soy yo?'
---

import TabItem from '@theme/TabItem';
import Tabs from '@theme/Tabs';

import SetupOauth from './_setup-oauth.mdx';
import SetupOidc from './_setup-oidc.mdx';

# Tutorial: ¬øQui√©n soy yo? (Who am I?)

Este tutorial te guiar√° a trav√©s del proceso de configuraci√≥n de MCP Auth para autenticar usuarios y recuperar su informaci√≥n de identidad desde el servidor de autorizaci√≥n.

Despu√©s de completar este tutorial, tendr√°s:

- ‚úÖ Una comprensi√≥n b√°sica de c√≥mo usar MCP Auth para autenticar usuarios.
- ‚úÖ Un servidor MCP que ofrece una herramienta para recuperar informaci√≥n de identidad del usuario.

## Descripci√≥n general \{#overview}

El tutorial involucrar√° los siguientes componentes:

- **Servidor MCP**: Un servidor MCP sencillo que utiliza los SDKs oficiales de MCP para manejar solicitudes.
- **Inspector MCP**: Una herramienta visual de pruebas para servidores MCP. Tambi√©n act√∫a como un cliente OAuth / OIDC para iniciar el flujo de autorizaci√≥n y recuperar tokens de acceso.
- **Servidor de autorizaci√≥n (Authorization server)**: Un proveedor OAuth 2.1 u OpenID Connect que gestiona identidades de usuario y emite tokens de acceso.

Aqu√≠ tienes un diagrama de alto nivel de la interacci√≥n entre estos componentes:

```mermaid
sequenceDiagram
    participant Client as Inspector MCP
    participant Server as Servidor MCP
    participant Auth as Servidor de autorizaci√≥n

    Client->>Server: Solicitar herramienta `whoami`
    Server->>Client: Retornar 401 No autorizado
    Client->>Auth: Iniciar flujo de autorizaci√≥n
    Auth->>Auth: Completar flujo de autorizaci√≥n
    Auth->>Client: Redirigir de vuelta con c√≥digo de autorizaci√≥n
    Client->>Auth: Intercambiar c√≥digo por token de acceso
    Auth->>Client: Retornar token de acceso
    Client->>Server: Solicitar `whoami` con token de acceso
    Server->>Auth: Obtener identidad de usuario con token de acceso
    Auth->>Server: Retornar identidad de usuario
    Server->>Client: Retornar identidad de usuario
```

## Comprende tu servidor de autorizaci√≥n \{#understand-your-authorization-server}

### Recuperar informaci√≥n de identidad del usuario \{#retrieving-user-identity-information}

Para completar este tutorial, tu servidor de autorizaci√≥n debe ofrecer una API para recuperar informaci√≥n de identidad del usuario:

<Tabs groupId="provider">
<TabItem value="logto" label="Logto">

[Logto](https://logto.io) es un proveedor OpenID Connect que admite el [endpoint userinfo](https://openid.net/specs/openid-connect-core-1_0.html#UserInfo) est√°ndar para recuperar informaci√≥n de identidad del usuario.

Para obtener un token de acceso que pueda usarse para acceder al endpoint userinfo, se requieren al menos dos alcances (scopes): `openid` y `profile`. Puedes seguir leyendo, ya que cubriremos la configuraci√≥n de alcances m√°s adelante.

</TabItem>
<TabItem value="keycloak" label="Keycloak">

[Keycloak](https://www.keycloak.org) es una soluci√≥n de gesti√≥n de identidad y acceso de c√≥digo abierto que admite m√∫ltiples protocolos, incluido OpenID Connect (OIDC). Como proveedor OIDC, implementa el [endpoint userinfo](https://openid.net/specs/openid-connect-core-1_0.html#UserInfo) est√°ndar para recuperar informaci√≥n de identidad del usuario.

Para obtener un token de acceso que pueda usarse para acceder al endpoint userinfo, se requieren al menos dos alcances: `openid` y `profile`. Puedes seguir leyendo, ya que cubriremos la configuraci√≥n de alcances m√°s adelante.

</TabItem>

<TabItem value="asgardeo" label="Asgardeo">

[Asgardeo](https://wso2.com/asgardeo) es una plataforma de identidad como servicio (IDaaS) nativa en la nube que admite OAuth 2.0 y OpenID Connect (OIDC), proporcionando una gesti√≥n robusta de identidad y acceso para aplicaciones modernas.

La informaci√≥n del usuario se codifica dentro del token de ID devuelto junto con el token de acceso. Pero como proveedor OIDC, Asgardeo expone un [endpoint UserInfo](https://wso2.com/asgardeo/docs/guides/authentication/oidc/request-user-info/) que permite a las aplicaciones recuperar reclamos sobre el usuario autenticado en el payload.

Tambi√©n puedes descubrir este endpoint din√°micamente a trav√©s del [endpoint de descubrimiento OIDC](https://wso2.com/asgardeo/docs/guides/authentication/oidc/discover-oidc-configs) o navegando a la pesta√±a 'Info' de la aplicaci√≥n en la Consola de Asgardeo.

Para obtener un token de acceso que pueda usarse para acceder al endpoint userinfo, se requieren al menos dos alcances: `openid` y `profile`.
</TabItem>
<TabItem value="oidc" label="OIDC">

La mayor√≠a de los proveedores OpenID Connect admiten el [endpoint userinfo](https://openid.net/specs/openid-connect-core-1_0.html#UserInfo) para recuperar informaci√≥n de identidad del usuario.

Consulta la documentaci√≥n de tu proveedor para ver si admite este endpoint. Si tu proveedor admite [OpenID Connect Discovery](https://openid.net/specs/openid-connect-discovery-1_0.html), tambi√©n puedes comprobar si el `userinfo_endpoint` est√° incluido en el documento de descubrimiento (respuesta del endpoint `.well-known/openid-configuration`).

Para obtener un token de acceso que pueda usarse para acceder al endpoint userinfo, se requieren al menos dos alcances: `openid` y `profile`. Consulta la documentaci√≥n de tu proveedor para ver el mapeo de alcances a reclamos de identidad de usuario.

</TabItem>
<TabItem value="oauth" label="OAuth 2">

Aunque OAuth 2.0 no define una forma est√°ndar de recuperar informaci√≥n de identidad del usuario, muchos proveedores implementan sus propios endpoints para hacerlo. Consulta la documentaci√≥n de tu proveedor para ver c√≥mo recuperar informaci√≥n de identidad del usuario usando un token de acceso y qu√© par√°metros se requieren para obtener dicho token de acceso al invocar el flujo de autorizaci√≥n.

</TabItem>
</Tabs>

### Registro din√°mico de clientes (Dynamic Client Registration) \{#dynamic-client-registration}

El registro din√°mico de clientes no es necesario para este tutorial, pero puede ser √∫til si deseas automatizar el proceso de registro del cliente MCP con tu servidor de autorizaci√≥n. Consulta [¬øSe requiere Dynamic Client Registration?](../../provider-list.mdx#is-dcr-required) para m√°s detalles.

## Configura el servidor MCP \{#set-up-the-mcp-server}

Usaremos los [SDKs oficiales de MCP](https://github.com/modelcontextprotocol) para crear un servidor MCP con una herramienta `whoami` que recupera informaci√≥n de identidad del usuario desde el servidor de autorizaci√≥n.

### Crea un nuevo proyecto \{#create-a-new-project}

<Tabs groupId="sdk">
<TabItem value="python" label="Python">

```bash
mkdir mcp-server
cd mcp-server
uv init # O usa `pipenv` o `poetry` para crear un nuevo entorno virtual
```

</TabItem>
<TabItem value="node" label="Node.js">

Configura un nuevo proyecto Node.js:

```bash
mkdir mcp-server
cd mcp-server
npm init -y # O usa `pnpm init`
npm pkg set type="module"
npm pkg set main="whoami.js"
npm pkg set scripts.start="node whoami.js"
```

</TabItem>
</Tabs>

### Instala el SDK de MCP y dependencias \{#install-the-mcp-sdk-and-dependencies}

<Tabs groupId="sdk">
<TabItem value="python" label="Python">

```bash
pip install "mcp[cli]" starlette uvicorn
```

O cualquier otro gestor de paquetes que prefieras, como `uv` o `poetry`.

</TabItem>
<TabItem value="node" label="Node.js">

```bash
npm install @modelcontextprotocol/sdk express
```

O cualquier otro gestor de paquetes que prefieras, como `pnpm` o `yarn`.

</TabItem>
</Tabs>

### Crea el servidor MCP \{#create-the-mcp-server}

Primero, vamos a crear un servidor MCP que implemente una herramienta `whoami`.

<Tabs groupId="sdk">
<TabItem value="python" label="Python">

Crea un archivo llamado `whoami.py` y a√±ade el siguiente c√≥digo:

```python
from mcp.server.fastmcp import FastMCP
from starlette.applications import Starlette
from starlette.routing import Mount
from typing import Any

mcp = FastMCP("WhoAmI")

@mcp.tool()
def whoami() -> dict[str, Any]:
    """Una herramienta que retorna la informaci√≥n del usuario actual."""
    return {"error": "Not authenticated"}

app = Starlette(
    routes=[Mount('/', app=mcp.sse_app())]
)
```

Ejecuta el servidor con:

```bash
uvicorn whoami:app --host 0.0.0.0 --port 3001
```

</TabItem>
<TabItem value="node" label="Node.js">

:::note
Dado que la implementaci√≥n actual del inspector MCP no maneja flujos de autorizaci√≥n, usaremos el enfoque SSE para configurar el servidor MCP. Actualizaremos el c√≥digo aqu√≠ una vez que el inspector MCP admita flujos de autorizaci√≥n.
:::

Tambi√©n puedes usar `pnpm` o `yarn` si lo prefieres.

Crea un archivo llamado `whoami.js` y a√±ade el siguiente c√≥digo:

```js
import { McpServer } from '@modelcontextprotocol/sdk/server/mcp.js';
import { SSEServerTransport } from '@modelcontextprotocol/sdk/server/sse.js';
import express from 'express';

// Crear un servidor MCP
const server = new McpServer({
  name: 'WhoAmI',
  version: '0.0.0',
});

// A√±adir una herramienta al servidor que retorna la informaci√≥n del usuario actual
server.tool('whoami', async () => {
  return {
    content: [{ type: 'text', text: JSON.stringify({ error: 'Not authenticated' }) }],
  };
});

// A continuaci√≥n el c√≥digo boilerplate de la documentaci√≥n del SDK de MCP
const PORT = 3001;
const app = express();

const transports = {};

app.get('/sse', async (_req, res) => {
  const transport = new SSEServerTransport('/messages', res);
  transports[transport.sessionId] = transport;

  res.on('close', () => {
    delete transports[transport.sessionId];
  });

  await server.connect(transport);
});

app.post('/messages', async (req, res) => {
  const sessionId = String(req.query.sessionId);
  const transport = transports[sessionId];
  if (transport) {
    await transport.handlePostMessage(req, res, req.body);
  } else {
    res.status(400).send('No transport found for sessionId');
  }
});

app.listen(PORT);
```

Ejecuta el servidor con:

```bash
npm start
```

</TabItem>
</Tabs>

## Inspecciona el servidor MCP \{#inspect-the-mcp-server}

### Clona y ejecuta el inspector MCP \{#clone-and-run-mcp-inspector}

Ahora que tenemos el servidor MCP en funcionamiento, podemos usar el inspector MCP para ver si la herramienta `whoami` est√° disponible.

Debido a la limitaci√≥n de la implementaci√≥n actual, hemos bifurcado el [inspector MCP](https://github.com/mcp-auth/inspector) para hacerlo m√°s flexible y escalable para autenticaci√≥n y autorizaci√≥n. Tambi√©n hemos enviado un pull request al repositorio original para incluir nuestros cambios.

Para ejecutar el inspector MCP, puedes usar el siguiente comando (se requiere Node.js):

```bash
git clone https://github.com/mcp-auth/inspector.git
cd inspector
npm install
npm run dev
```

Luego, abre tu navegador y navega a `http://localhost:6274/` (u otra URL mostrada en la terminal) para acceder al inspector MCP.

### Conecta el inspector MCP al servidor MCP \{#connect-mcp-inspector-to-the-mcp-server}

Antes de continuar, verifica la siguiente configuraci√≥n en el inspector MCP:

- **Tipo de transporte (Transport Type)**: Establece en `SSE`.
- **URL**: Establece la URL de tu servidor MCP. En nuestro caso, debe ser `http://localhost:3001/sse`.

Ahora puedes hacer clic en el bot√≥n "Connect" para ver si el inspector MCP puede conectarse al servidor MCP. Si todo est√° bien, deber√≠as ver el estado "Connected" en el inspector MCP.

### Punto de control: Ejecuta la herramienta `whoami` \{#checkpoint-run-the-whoami-tool}

1. En el men√∫ superior del inspector MCP, haz clic en la pesta√±a "Tools".
2. Haz clic en el bot√≥n "List Tools".
3. Deber√≠as ver la herramienta `whoami` listada en la p√°gina. Haz clic en ella para abrir los detalles de la herramienta.
4. Deber√≠as ver el bot√≥n "Run Tool" en el lado derecho. Haz clic en √©l para ejecutar la herramienta.
5. Deber√≠as ver el resultado de la herramienta con la respuesta JSON `{"error": "Not authenticated"}`.

![Primera ejecuci√≥n del inspector MCP](/docs-assets/images/tutorials/whoami/inspector-first-run.png)

## Integra con tu servidor de autorizaci√≥n \{#integrate-with-your-authorization-server}

Para completar esta secci√≥n, hay varias consideraciones a tener en cuenta:

<details>
<summary>**La URL del emisor (issuer) de tu servidor de autorizaci√≥n**</summary>

Normalmente es la URL base de tu servidor de autorizaci√≥n, como `https://auth.example.com`. Algunos proveedores pueden tener una ruta como `https://example.logto.app/oidc`, as√≠ que aseg√∫rate de consultar la documentaci√≥n de tu proveedor.

</details>

<details>
<summary>**C√≥mo recuperar los metadatos del servidor de autorizaci√≥n**</summary>

- Si tu servidor de autorizaci√≥n cumple con [OAuth 2.0 Authorization Server Metadata](https://datatracker.ietf.org/doc/html/rfc8414) o [OpenID Connect Discovery](https://openid.net/specs/openid-connect-discovery-1_0.html), puedes usar las utilidades integradas de MCP Auth para obtener los metadatos autom√°ticamente.
- Si tu servidor de autorizaci√≥n no cumple con estos est√°ndares, deber√°s especificar manualmente la URL de metadatos o los endpoints en la configuraci√≥n del servidor MCP. Consulta la documentaci√≥n de tu proveedor para los endpoints espec√≠ficos.

</details>

<details>
<summary>**C√≥mo registrar el inspector MCP como cliente en tu servidor de autorizaci√≥n**</summary>

- Si tu servidor de autorizaci√≥n admite [Dynamic Client Registration](https://datatracker.ietf.org/doc/html/rfc7591), puedes omitir este paso ya que el inspector MCP se registrar√° autom√°ticamente como cliente.
- Si tu servidor de autorizaci√≥n no admite Dynamic Client Registration, deber√°s registrar manualmente el inspector MCP como cliente en tu servidor de autorizaci√≥n.

</details>

<details>
<summary>**C√≥mo recuperar informaci√≥n de identidad del usuario y c√≥mo configurar los par√°metros de la solicitud de autorizaci√≥n**</summary>

- Para proveedores OpenID Connect: normalmente necesitas solicitar al menos los alcances `openid` y `profile` al iniciar el flujo de autorizaci√≥n. Esto asegurar√° que el token de acceso devuelto por el servidor de autorizaci√≥n contenga los alcances necesarios para acceder al [endpoint userinfo](https://openid.net/specs/openid-connect-core-1_0.html#UserInfo) y recuperar informaci√≥n de identidad del usuario.

  Nota: Algunos proveedores pueden no admitir el endpoint userinfo.

- Para proveedores OAuth 2.0 / OAuth 2.1: consulta la documentaci√≥n de tu proveedor para ver c√≥mo recuperar informaci√≥n de identidad del usuario usando un token de acceso y qu√© par√°metros se requieren para obtener dicho token de acceso al invocar el flujo de autorizaci√≥n.

</details>

Aunque cada proveedor puede tener sus propios requisitos espec√≠ficos, los siguientes pasos te guiar√°n en el proceso de integraci√≥n del inspector MCP y el servidor MCP con configuraciones espec√≠ficas del proveedor.

### Registra el inspector MCP como cliente \{#register-mcp-inspector-as-a-client}

<Tabs groupId="provider">
<TabItem value="logto" label="Logto">

Integrar con [Logto](https://logto.io) es sencillo ya que es un proveedor OpenID Connect que admite el [endpoint userinfo](https://openid.net/specs/openid-connect-core-1_0.html#UserInfo) est√°ndar para recuperar informaci√≥n de identidad del usuario.

Como Logto a√∫n no admite Dynamic Client Registration, deber√°s registrar manualmente el inspector MCP como cliente en tu tenant de Logto:

1. Abre tu inspector MCP, haz clic en el bot√≥n "OAuth Configuration". Copia el valor de **Redirect URL (auto-populated)**, que deber√≠a ser algo como `http://localhost:6274/oauth/callback`.
2. Inicia sesi√≥n en [Logto Console](https://cloud.logto.io) (o tu instancia autogestionada de Logto Console).
3. Navega a la pesta√±a "Applications", haz clic en "Create application". En la parte inferior de la p√°gina, haz clic en "Create app without framework".
4. Rellena los detalles de la aplicaci√≥n y haz clic en "Create application":
   - **Selecciona un tipo de aplicaci√≥n**: Elige "Single-page application".
   - **Nombre de la aplicaci√≥n**: Ingresa un nombre para tu aplicaci√≥n, por ejemplo, "MCP Inspector".
5. En la secci√≥n "Settings / Redirect URIs", pega el valor de **Redirect URL (auto-populated)** que copiaste del inspector MCP. Luego haz clic en "Save changes" en la barra inferior.
6. En la tarjeta superior, ver√°s el valor "App ID". C√≥pialo.
7. Vuelve al inspector MCP y pega el valor "App ID" en la secci√≥n "OAuth Configuration" bajo "Client ID".
8. Ingresa el valor `{"scope": "openid profile email"}` en el campo "Auth Params". Esto asegurar√° que el token de acceso devuelto por Logto contenga los alcances necesarios para acceder al endpoint userinfo.

</TabItem>
<TabItem value="keycloak" label="Keycloak">

[Keycloak](https://www.keycloak.org) es una soluci√≥n de gesti√≥n de identidad y acceso de c√≥digo abierto que admite el protocolo OpenID Connect.

Aunque Keycloak admite el registro din√°mico de clientes, su endpoint de registro de clientes no admite CORS, lo que impide que la mayor√≠a de los clientes MCP se registren directamente. Por lo tanto, necesitaremos registrar nuestro cliente manualmente.

:::note
Aunque Keycloak puede instalarse de [varias formas](https://www.keycloak.org/guides#getting-started) (bare metal, kubernetes, etc.), para este tutorial, usaremos Docker para una configuraci√≥n r√°pida y sencilla.
:::

Configura una instancia de Keycloak y aj√∫stala a nuestras necesidades:

1. Primero, ejecuta una instancia de Keycloak usando Docker siguiendo la [documentaci√≥n oficial](https://www.keycloak.org/getting-started/getting-started-docker):

```bash
docker run -p 8080:8080 -e KC_BOOTSTRAP_ADMIN_USERNAME=admin -e KC_BOOTSTRAP_ADMIN_PASSWORD=admin quay.io/keycloak/keycloak:26.2.4 start-dev
```

2. Accede a la consola de administraci√≥n de Keycloak (http://localhost:8080/admin) e inicia sesi√≥n con estas credenciales:

   - Usuario: `admin`
   - Contrase√±a: `admin`

3. Crea un nuevo Realm:

   - Haz clic en "Create Realm" en la esquina superior izquierda
   - Ingresa `mcp-realm` en el campo "Realm name"
   - Haz clic en "Create"

4. Crea un usuario de prueba:

   - Haz clic en "Users" en el men√∫ izquierdo
   - Haz clic en "Create new user"
   - Rellena los detalles del usuario:
     - Usuario: `testuser`
     - Nombre y apellido pueden ser cualquier valor
   - Haz clic en "Create"
   - En la pesta√±a "Credentials", establece una contrase√±a y desmarca "Temporary"

5. Registra el inspector MCP como cliente:

   - Abre tu inspector MCP, haz clic en el bot√≥n "OAuth Configuration". Copia el valor de **Redirect URL (auto-populated)**, que deber√≠a ser algo como `http://localhost:6274/oauth/callback`.
   - En la consola de administraci√≥n de Keycloak, haz clic en "Clients" en el men√∫ izquierdo
   - Haz clic en "Create client"
   - Rellena los detalles del cliente:
     - Tipo de cliente: Selecciona "OpenID Connect"
     - Client ID: Ingresa `mcp-inspector`
     - Haz clic en "Next"
   - En la p√°gina "Capability config":
     - Aseg√∫rate de que "Standard flow" est√© habilitado
     - Haz clic en "Next"
   - En la p√°gina "Login settings":
     - Pega la URL de callback del inspector MCP previamente copiada en "Valid redirect URIs"
     - Ingresa `http://localhost:6274` en "Web origins"
     - Haz clic en "Save"
   - Copia el "Client ID" (que es `mcp-inspector`)

6. De vuelta en el inspector MCP:
   - Pega el Client ID copiado en el campo "Client ID" en la secci√≥n "OAuth Configuration"
   - Ingresa el siguiente valor en el campo "Auth Params" para solicitar los alcances necesarios:

```json
{ "scope": "openid profile email" }
```

 </TabItem>
<TabItem value="asgardeo" label="Asgardeo">

Aunque Asgardeo admite el registro din√°mico de clientes a trav√©s de una API est√°ndar, el endpoint est√° protegido y requiere un token de acceso con los permisos necesarios. En este tutorial, registraremos el cliente manualmente a trav√©s de la Consola de Asgardeo.

:::note
Si no tienes una cuenta de Asgardeo, puedes [registrarte gratis](https://asgardeo.io).
:::

Sigue estos pasos para configurar Asgardeo para el inspector MCP:

1. Inicia sesi√≥n en la [Consola de Asgardeo](https://console.asgardeo.io) y selecciona tu organizaci√≥n.

2. Crea una nueva aplicaci√≥n:
    - Ve a **Applications** ‚Üí **New Application**
    - Elige **Single-Page Application**
    - Ingresa un nombre de aplicaci√≥n como `MCP Inspector`
    - En el campo **Authorized Redirect URLs**, pega la **Redirect URL** copiada de la aplicaci√≥n cliente MCP Inspector (por ejemplo: `http://localhost:6274/oauth/callback`)
    - Haz clic en **Create**

3. Configura los ajustes del protocolo:
    - Bajo la pesta√±a **Protocol**:
    - Copia el **Client ID** que se gener√≥ autom√°ticamente.
    - Aseg√∫rate de cambiar a `JWT` en la secci√≥n **Access Token** para el `Token Type`
    - Haz clic en **Update**

4. En la aplicaci√≥n cliente MCP Inspector:
    - Abre la secci√≥n **OAuth Configuration**
    - Pega el **Client ID** copiado
    - Ingresa lo siguiente en el campo **Auth Params** para solicitar los alcances necesarios:

```json
{ "scope": "openid profile email" }
```
 </TabItem>
<TabItem value="oidc" label="OIDC">

:::note
Esta es una gu√≠a gen√©rica de integraci√≥n con proveedores OpenID Connect. Consulta la documentaci√≥n de tu proveedor para detalles espec√≠ficos.
:::

Si tu proveedor OpenID Connect admite Dynamic Client Registration, puedes ir directamente al paso 8 a continuaci√≥n para configurar el inspector MCP; de lo contrario, deber√°s registrar manualmente el inspector MCP como cliente en tu proveedor OpenID Connect:

1. Abre tu inspector MCP, haz clic en el bot√≥n "OAuth Configuration". Copia el valor de **Redirect URL (auto-populated)**, que deber√≠a ser algo como `http://localhost:6274/oauth/callback`.
2. Inicia sesi√≥n en la consola de tu proveedor OpenID Connect.
3. Navega a la secci√≥n "Applications" o "Clients", luego crea una nueva aplicaci√≥n o cliente.
4. Si tu proveedor requiere un tipo de cliente, selecciona "Single-page application" o "Public client".
5. Despu√©s de crear la aplicaci√≥n, deber√°s configurar la URI de redirecci√≥n. Pega el valor de **Redirect URL (auto-populated)** que copiaste del inspector MCP.
6. Busca el "Client ID" o "Application ID" de la aplicaci√≥n reci√©n creada y c√≥pialo.
7. Vuelve al inspector MCP y pega el valor "Client ID" en la secci√≥n "OAuth Configuration" bajo "Client ID".
8. Para proveedores OpenID Connect est√°ndar, puedes ingresar el siguiente valor en el campo "Auth Params" para solicitar los alcances necesarios para acceder al endpoint userinfo:

```json
{ "scope": "openid profile email" }
```

</TabItem>
<TabItem value="oauth" label="OAuth 2">

:::note
Esta es una gu√≠a gen√©rica de integraci√≥n con proveedores OAuth 2.0 / OAuth 2.1. Consulta la documentaci√≥n de tu proveedor para detalles espec√≠ficos.
:::

Si tu proveedor OAuth 2.0 / OAuth 2.1 admite Dynamic Client Registration, puedes ir directamente al paso 8 a continuaci√≥n para configurar el inspector MCP; de lo contrario, deber√°s registrar manualmente el inspector MCP como cliente en tu proveedor OAuth 2.0 / OAuth 2.1:

1. Abre tu inspector MCP, haz clic en el bot√≥n "OAuth Configuration". Copia el valor de **Redirect URL (auto-populated)**, que deber√≠a ser algo como `http://localhost:6274/oauth/callback`.
2. Inicia sesi√≥n en la consola de tu proveedor OAuth 2.0 / OAuth 2.1.
3. Navega a la secci√≥n "Applications" o "Clients", luego crea una nueva aplicaci√≥n o cliente.
4. Si tu proveedor requiere un tipo de cliente, selecciona "Single-page application" o "Public client".
5. Despu√©s de crear la aplicaci√≥n, deber√°s configurar la URI de redirecci√≥n. Pega el valor de **Redirect URL (auto-populated)** que copiaste del inspector MCP.
6. Busca el "Client ID" o "Application ID" de la aplicaci√≥n reci√©n creada y c√≥pialo.
7. Vuelve al inspector MCP y pega el valor "Client ID" en la secci√≥n "OAuth Configuration" bajo "Client ID".
8. Lee la documentaci√≥n de tu proveedor para ver c√≥mo recuperar tokens de acceso para informaci√≥n de identidad del usuario. Puede que necesites especificar los alcances o par√°metros requeridos para obtener el token de acceso. Por ejemplo, si tu proveedor requiere el alcance `profile` para acceder a la informaci√≥n de identidad del usuario, puedes ingresar el siguiente valor en el campo "Auth Params":

```json
{ "scope": "profile" }
```

</TabItem>
</Tabs>

### Configura MCP auth \{#set-up-mcp-auth}

En tu proyecto de servidor MCP, necesitas instalar el SDK de MCP Auth y configurarlo para usar los metadatos de tu servidor de autorizaci√≥n.

<Tabs groupId="sdk">
<TabItem value="python" label="Python">

Primero, instala el paquete `mcpauth`:

```bash
pip install mcpauth
```

O cualquier otro gestor de paquetes que prefieras, como `uv` o `poetry`.

</TabItem>
<TabItem value="node" label="Node.js">

Primero, instala el paquete `mcp-auth`:

```bash
npm install mcp-auth
```

</TabItem>
</Tabs>

MCP Auth requiere los metadatos del servidor de autorizaci√≥n para poder inicializarse. Dependiendo de tu proveedor:

<Tabs groupId="provider">

<TabItem value="logto" label="Logto">

La URL del emisor (issuer) se puede encontrar en la p√°gina de detalles de tu aplicaci√≥n en Logto Console, en la secci√≥n "Endpoints & Credentials / Issuer endpoint". Deber√≠a verse como `https://my-project.logto.app/oidc`.

<SetupOidc />

</TabItem>

<TabItem value="keycloak" label="Keycloak">

La URL del emisor (issuer) se puede encontrar en tu consola de administraci√≥n de Keycloak. En tu 'mcp-realm', navega a la secci√≥n "Realm settings / Endpoints" y haz clic en el enlace "OpenID Endpoint Configuration". El campo `issuer` en el documento JSON contendr√° tu URL de emisor, que deber√≠a verse como `http://localhost:8080/realms/mcp-realm`.

<SetupOidc />

</TabItem>

<TabItem value="asgardeo" label="Asgardeo">

    Puedes encontrar la URL del emisor en la Consola de Asgardeo. Navega a la aplicaci√≥n creada y abre la pesta√±a **Info**. El campo **Issuer** se mostrar√° all√≠ y deber√≠a verse as√≠:
    `https://api.asgardeo.io/t/<your-organization-name>/oauth2/token`
    
    <SetupOidc />

</TabItem>

<TabItem value="oidc" label="OIDC">

El siguiente c√≥digo tambi√©n asume que el servidor de autorizaci√≥n admite el [endpoint userinfo](https://openid.net/specs/openid-connect-core-1_0.html#UserInfo) para recuperar informaci√≥n de identidad del usuario. Si tu proveedor no admite este endpoint, deber√°s consultar la documentaci√≥n de tu proveedor para el endpoint espec√≠fico y reemplazar la variable del endpoint userinfo con la URL correcta.

<SetupOidc showAlternative />

</TabItem>
<TabItem value="oauth" label="OAuth 2">

Como mencionamos antes, OAuth 2.0 no define una forma est√°ndar de recuperar informaci√≥n de identidad del usuario. El siguiente c√≥digo asume que tu proveedor tiene un endpoint espec√≠fico para recuperar informaci√≥n de identidad del usuario usando un token de acceso. Deber√°s consultar la documentaci√≥n de tu proveedor para el endpoint espec√≠fico y reemplazar la variable del endpoint userinfo con la URL correcta.

<SetupOauth />

</TabItem>
</Tabs>

### Actualiza el servidor MCP \{#update-mcp-server}

¬°Ya casi terminamos! Es momento de actualizar el servidor MCP para aplicar la ruta y funci√≥n middleware de MCP Auth, y luego hacer que la herramienta `whoami` retorne la informaci√≥n real de identidad del usuario.

<Tabs groupId="sdk">
<TabItem value="python" label="Python">

```python
@mcp.tool()
def whoami() -> dict[str, Any]:
    """Una herramienta que retorna la informaci√≥n del usuario actual."""
    return (
        mcp_auth.auth_info.claims
        if mcp_auth.auth_info # Esto ser√° completado por el middleware Bearer auth
        else {"error": "Not authenticated"}
    )

# ...

bearer_auth = Middleware(mcp_auth.bearer_auth_middleware(verify_access_token))
app = Starlette(
    routes=[
        # A√±ade la ruta de metadatos (`/.well-known/oauth-authorization-server`)
        mcp_auth.metadata_route(),
        # Protege el servidor MCP con el middleware Bearer auth
        Mount('/', app=mcp.sse_app(), middleware=[bearer_auth]),
    ],
)
```

</TabItem>
<TabItem value="node" label="Node.js">

```js
server.tool('whoami', ({ authInfo }) => {
  return {
    content: [
      { type: 'text', text: JSON.stringify(authInfo?.claims ?? { error: 'Not authenticated' }) },
    ],
  };
});

// ...

app.use(mcpAuth.delegatedRouter());
app.use(mcpAuth.bearerAuth(verifyToken));
```

</TabItem>
</Tabs>

## Punto de control: Ejecuta la herramienta `whoami` con autenticaci√≥n \{#checkpoint-run-the-whoami-tool-with-authentication}

Reinicia tu servidor MCP y abre el inspector MCP en tu navegador. Cuando hagas clic en el bot√≥n "Connect", deber√≠as ser redirigido a la p√°gina de inicio de sesi√≥n de tu servidor de autorizaci√≥n.

Una vez que inicies sesi√≥n y regreses al inspector MCP, repite las acciones que hicimos en el punto de control anterior para ejecutar la herramienta `whoami`. Esta vez, deber√≠as ver la informaci√≥n de identidad del usuario retornada por el servidor de autorizaci√≥n.

![Resultado de la herramienta whoami en el inspector MCP](/docs-assets/images/tutorials/whoami/result.png)

<Tabs groupId="sdk">
<TabItem value="python" label="Python">

:::info
Consulta el [repositorio del SDK de MCP Auth para Python](https://github.com/mcp-auth/python/blob/master/samples/server/whoami.py) para ver el c√≥digo completo del servidor MCP (versi√≥n OIDC).
:::

</TabItem>
<TabItem value="node" label="Node.js">

:::info
Consulta el [repositorio del SDK de MCP Auth para Node.js](https://github.com/mcp-auth/js/blob/master/packages/sample-servers/src) para ver el c√≥digo completo del servidor MCP (versi√≥n OIDC). Este directorio contiene versiones en TypeScript y JavaScript del c√≥digo.
:::

</TabItem>
</Tabs>

## Notas finales \{#closing-notes}

üéä ¬°Felicidades! Has completado con √©xito el tutorial. Recapitulemos lo que hemos hecho:

- Configuraci√≥n de un servidor MCP b√°sico con la herramienta `whoami`
- Integraci√≥n del servidor MCP con un servidor de autorizaci√≥n usando MCP Auth
- Configuraci√≥n del Inspector MCP para autenticar usuarios y recuperar su informaci√≥n de identidad

Tambi√©n puedes explorar algunos temas avanzados, incluyendo:

- Uso de [JWT (JSON Web Token)](https://auth.wiki/jwt) para autenticaci√≥n y autorizaci√≥n
- Aprovechar [indicadores de recurso (RFC 8707)](https://auth-wiki.logto.io/resource-indicator) para especificar los recursos a los que se accede
- Implementar mecanismos de control de acceso personalizados, como [control de acceso basado en roles (RBAC)](https://auth.wiki/rbac) o [control de acceso basado en atributos (ABAC)](https://auth.wiki/abac)

Aseg√∫rate de consultar otros tutoriales y documentaci√≥n para sacar el m√°ximo provecho de MCP Auth.